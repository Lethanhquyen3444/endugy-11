<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ENDUGY APP - ENGLISH EDUCATION ENERGY </title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Montserrat', sans-serif;
      display: flex;
      height: 100vh;
      background: #e3f2fd;
      color: #0d47a1;
    }
    .sidebar {
      width: 220px;
      background: #1565c0;
      padding: 2rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      color: #fff;
    }
    .sidebar h1 {
      font-size: 1.5rem;
      margin-bottom: 2rem;
      text-align: center;
    }
    .sidebar button {
      background: transparent;
      border: none;
      color: #fff;
      font-size: 1.1rem;
      font-weight: bold;
      padding: 0.8rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      text-align: left;
      transition: background 0.3s;
    }
    .sidebar button:hover, .sidebar button.active {
      background: #0d47a1;
    }

    /*logo*/
        .logo {
      display: flex;
      align-items: center; /* cƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
      gap: 0px; /* kho·∫£ng c√°ch gi·ªØa ·∫£nh v√† ch·ªØ */
    }

    .logo img {
      display: block;
      margin-right: 5px;
    }

    .logo h1 {
      font-size: 20px; /* tu·ª≥ ch·ªânh c·ª° ch·ªØ */
      margin: 0; /* b·ªè margin m·∫∑c ƒë·ªãnh */
    }

    .main-content {
      flex: 1;
      display: flex;
    }
    .content-section {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
      display: none;
    }
    .content-section.active {
      display: block;
    }
    .dictionary {
      width: 300px;
      background-color: #1565c0;
      color: white;
      padding: 2rem;
      overflow-y: auto;
    }
    .search-box input {
      width: 100%;
      padding: 0.5rem;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
    }
    .word-list {
      list-style: none;
      padding: 0;
      margin-top: 1rem;
      max-height: 60vh;
      overflow-y: auto;
    }
    .word-item {
      padding: 0.5rem;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      cursor: pointer;
    }
    .word-item:hover {
      background-color: #0d47a1;
    }
    .quiz-question {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: #1565c0;
    }
    .options {
      list-style: none;
      padding: 0;
      margin: 0 0 1.5rem 0;
    }
    .option {
      background: #bbdefb;
      margin-bottom: 1rem;
      padding: 0.9rem 1.3rem;
      border-radius: 10px;
      color: #0d47a1;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 600;
      transition: background-color 0.3s ease;
      box-shadow: 0 2px 5px rgba(21,101,192,0.2);
    }
    .option:hover {
      background: #90caf9;
      color: #0d47a1;
    }
    .option.correct {
      background: #4caf50 !important;
      color: #fff;
      cursor: default;
      box-shadow: 0 2px 8px rgba(76,175,80,0.8);
    }
    .option.incorrect {
      background: #e53935 !important;
      color: #fff;
      cursor: default;
      box-shadow: 0 2px 8px rgba(229,57,53,0.8);
    }
    .feedback {
      font-size: 1.2rem;
      font-weight: 600;
      height: 1.5rem;
      margin-bottom: 1rem;
    }
    .btn-next {
      background: #1565c0;
      border: none;
      padding: 0.8rem 2rem;
      font-weight: 700;
      font-size: 1.1rem;
      color: #fff;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      box-shadow: 0 4px 15px rgba(21,101,192,0.7);
    }
    .btn-next:disabled {
      background: #90caf9;
      cursor: not-allowed;
      box-shadow: none;
      color: #0d47a1;
    }
    .btn-next:hover:not(:disabled) {
      background: #0d47a1;
    }
    .definition-page {
      padding: 2rem;
      background: #ffffff;
      color: #0d47a1;
      height: 100%;
      overflow-y: auto;
    }
    .definition-page .examples {
      margin-top: 1rem;
      background: #f0f0f0;
      padding: 1rem;
      border-radius: 8px;
    }
    #vocab-games {
      background: #ffffff;
      color: #0d47a1;
      padding: 2rem;
    }
    .vocab-game-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-top: 1rem;
    }
    .game-box {
      background: #e3f2fd;
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
      cursor: pointer;
    }
    .game-box:hover {
      transform: scale(1.05);
    }
    .game-icon {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
    .game-label {
      font-size: 1.1rem;
      font-weight: 600;
    }
    .level-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }
    .level-box {
      background: #e3f2fd;
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
      cursor: pointer;
    }
    .level-box:hover {
      transform: scale(1.05);
    }
    .level-icon {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
    .level-label {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1565c0;
    }
    /* Tenses section */
    .tense-card {
      background: white;
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .tense-title {
      color: #1565c0;
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
      font-weight: bold;
    }
    .tense-formula {
      background: #e3f2fd;
      padding: 0.8rem;
      border-radius: 6px;
      font-family: monospace;
      margin: 0.5rem 0;
    }
    .tense-example {
      padding: 0.8rem;
      border-left: 3px solid #1565c0;
      margin: 0.5rem 0;
      background: #f5f5f5;
    }
    .tense-usage {
      margin-top: 0.8rem;
      font-style: italic;
      color: #555;
    }
    .tense-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .tense-icon {
      width: 40px;
      height: 40px;
      background-color: #1565c0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }
    /* Hi·ªáu ·ª©ng k·∫øt th√∫c b√†i t·∫≠p */
    #result-modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    .result-box {
      background: #fff;
      padding: 2rem;
      border-radius: 16px;
      text-align: center;
      animation: popIn 0.6s ease;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .result-box h2 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #1565c0;
    }

    .result-box p {
      font-size: 1.3rem;
      margin-bottom: 1.5rem;
      color: #333;
    }

    .result-btn {
      display: inline-block;
      margin: 0.5rem;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    #retry-btn {
      background: #1565c0;
      color: #fff;
    }
    #retry-btn:hover {
      background: #0d47a1;
    }

    #exit-btn {
      background: #e53935;
      color: #fff;
    }
    #exit-btn:hover {
      background: #b71c1c;
    }

    @keyframes popIn {
      from { transform: scale(0.7); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    /* Thanh h·ªó tr·ª£ m·ªü r·ªông t·ª´ v·ª±ng */
    .top-tab-bar {
      display: flex;
      background: #1565c0;
      overflow-x: auto;
    }
    .tab-item {
      flex: 1;
      background: transparent;
      border: none;
      color: #fff;
      padding: 0.8rem 1.2rem;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      white-space: nowrap;
      transition: background 0.2s;
    }
    .tab-item.active {
      border-bottom: 3px solid #fff;
    }

    .tab-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

/*C√¢u*/
 #sentence {
      background: #ffffff;
      color: #0d47a1;
      padding: 2rem;
    }
    .sentence-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-top: 1rem;
    }
    .sentence-box {
      background: #e3f2fd;
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
      cursor: pointer;
    }
    .sentence-box:hover {
      transform: scale(1.05);
    }
    .sentence-icon {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
    .sentence-label {
      font-size: 1.1rem;
      font-weight: 600;
    }

  /* B√†i T·∫≠p AI */
  .exercise-btn {
    margin-top: 10px;
    padding: 8px 12px;
    background: #1976d2;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  .exercise-btn:hover {
    background: #125ea6;
  }
  #exercise-area {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: #fff;
    padding: 2rem;
    overflow-y: auto;
    display: none; /* ·∫©n m·∫∑c ƒë·ªãnh */
  }

  #back-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    margin-bottom: 1rem;
  }

  .question-block {
    margin-bottom: 1.5rem;
    padding: 1rem;
    border: 1px solid #ccc;
    border-radius: 8px;
    background: #f9f9f9;
  }

  /* h·ªôp kh√¥ng gian c·ªßa ph·∫ßn c√¢u */
#expression-area .expression-box {
  background: #e3f2fd;
  border-radius: 10px;
  margin-bottom: 1.2rem;
  padding: 1rem 1.2rem;
  box-shadow: 0 2px 8px rgba(21,101,192,0.08);
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}
#expression-area .expression-en {
  font-size: 1.1rem;
  font-weight: bold;
  color: #1976d2;
  display: flex;
  align-items: center;
  gap: 8px;
}
#expression-area .expression-ipa {
  color: #444;
  font-style: italic;
}
#expression-area .expression-vn {
  color: #0d47a1;
}

/**/
.circle-mark {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-left: 8px;
  font-size: 16px;
  font-weight: bold;
}
.circle-mark.red {
  background: #e53935;
  color: #fff;
}
.circle-mark.green {
  background: #4caf50;
  color: #fff;
}
.mc-option {
  background: #bbdefb;
  padding: 1rem;
  margin-bottom: 1rem;
  border-radius: 10px;
  font-size: 1.2rem;
  cursor: pointer;
  font-weight: 600;
  color:#0d47a1;
}
.mc-option:hover { background: #90caf9; }
.mc-option.disabled { pointer-events:none; }


/**/
.cb-card {
  padding: 1.5rem;
  border-radius: 12px;
  text-align: center;
  font-size: 1.2rem;
  font-weight: 600;
  cursor: pointer;
  background: #f0f0f0;
  transition: all 0.3s ease;
}
.cb-card.gray {
  background: #e0e0e0;
  color: #555;
}
.cb-card.correct {
  background: #4caf50;
  color: #fff;
  cursor: default;
}
.cb-card.incorrect {
  background: #e53935;
  color: #fff;
  opacity: 0.5;
}
#cb-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* 4 c·ªôt ƒë·ªÉ ch·ª©a 12 √¥ ƒë·∫πp */
  gap: 1rem;
  margin-top: 2rem;
}

/*Flash Card*/ 
.flashcard {
  background: #ffeb99;
  border-radius: 12px;
  padding: 1rem;
  text-align: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
.flashcard.placeholder {
  background: #e0e0e0;
  cursor: pointer;
}
.flashcard.placeholder span {
  font-size: 2rem;
  font-weight: bold;
  color: #555;
}
.modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.modal-content {
  background: #fff;
  padding: 1.5rem;
  border-radius: 12px;
  text-align: center;
  max-width: 300px;
}
.modal-content button {
  margin-top: 1rem;
  padding: 0.5rem 1rem;
  background: #1565c0;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
.flashcard {
  width: 200px;
  height: 130px;
  perspective: 1000px;
  cursor: pointer;
  position: relative;
}

.flashcard-inner {
  position: relative;
  width: 100%;
  height: 100%;
  transition: transform 0.6s;
  transform-style: preserve-3d;
}

.flashcard.flipped .flashcard-inner {
  transform: rotateY(180deg);
}

.flashcard-front, .flashcard-back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  text-align: center;
  padding: 1rem;
  box-shadow: 0 6px 15px rgba(0,0,0,0.15);
  font-family: 'Montserrat', sans-serif;
}

/* M·∫∑t tr∆∞·ªõc */
.flashcard-front {
  background: #ffffff;
  color: #1565c0;
  font-weight: bold;
  font-size: 1.2rem;
  letter-spacing: 0.5px;
}

/* M·∫∑t sau */
.flashcard-back {
  background: linear-gradient(135deg, #1565c0, #673ab7);
  color: #fff;
  transform: rotateY(180deg);
  font-size: 1rem;
  font-weight: 500;
}
.flashcard-back small {
  margin-top: 6px;
  font-style: italic;
  opacity: 0.9;
}



  </style>
</head>
<body>

  <div class="sidebar">
    <div class="logo">
    <img width="50px" src="https://cdn-icons-gif.flaticon.com/15557/15557778.gif"; >
    <h1>ENDUGY APP</h1> 
    </div>
    
    <button onclick="showSection('dictionary')" class="active">T·ª´ ƒêi·ªÉn</button>
    <button onclick="showSection('vocab-games')">Tr√≤ Ch∆°i T·ª´ V·ª±ng</button>
    <button onclick="showSection('tenses')">Th√¨</button>
    <button onclick="showSection('sentence')">C√¢u</button>
    <button onclick="showSection('sentence-games')"> Tr√≤ Ch∆°i C√¢u</button>
    <button onclick="showSection('card')">Flash Card</button>
    <button onclick="openAccount()">T√†i kho·∫£n c·ªßa t√¥i</button>
  </div>


  <div class="main-content">
    <div id="dictionary" class="dictionary content-section active">
      <h2>T·ª´ ƒëi·ªÉn</h2>
      <div class="search-box" style="display: flex; gap: 0.5rem; align-items: center;">
        <button id="micBtn" title="Thu √¢m" style="background: #0d47a1; border: none; color: white; padding: 0.5rem; border-radius: 6px; cursor: pointer;">üé§</button>
        <input type="text" id="searchInput" placeholder="T√¨m t·ª´ ti·∫øng Anh..." />
      </div>
      <ul class="word-list" id="wordList"></ul>
    </div>

    <!-- KH√îNG GIAN B√ÄI T·∫¨P -->
    <div id="exercise-area" class="hidden">
      <button id="back-btn" onclick="closeExercise()">‚Üê</button>
      <h2 id="exercise-title"></h2>
      <div id="exercise-questions"></div>
    </div>

    <div id="tenses" class="content-section">
  <h2>English Tenses</h2>

  <!-- Present Simple -->
  <div class="tense-card">
    <div id="exercise-box"></div>
    <div class="tense-header">
      <h3 class="tense-title">Present Simple</h3>
      <div class="tense-icon">1</div>
    </div>
    <div class="tense-formula">Subject + V1/Vs/es + Object</div>
    <div class="tense-example">
      <strong>Example:</strong> She works at a bank.
    </div>
    <div class="tense-usage">
      Used for habits, general truths, repeated actions <br>
    <button class="exercise-btn" onclick="generateExercise('Present Simple')">B√†i t·∫≠p</button>
    </div>
  </div>

  <!-- Present Continuous -->
  <div class="tense-card">
    <div id="exercise-box"></div>
    <div class="tense-header">
      <h3 class="tense-title">Present Continuous</h3>
      <div class="tense-icon">2</div>
    </div>
    <div class="tense-formula">Subject + am/is/are + V-ing + Object</div>
    <div class="tense-example">
      <strong>Example:</strong> They are watching TV now.
    </div>
    <div class="tense-usage">
      Used for actions happening now or around now, temporary situations <br>
      <button class="exercise-btn" onclick="generateExercise('Present Continuous')">B√†i t·∫≠p</button>
    </div>
  </div>

  <!-- Present Perfect -->
  <div class="tense-card">
    <div id="exercise-box"></div>
    <div class="tense-header">
      <h3 class="tense-title">Present Perfect</h3>
      <div class="tense-icon">3</div>
    </div>
    <div class="tense-formula">Subject + have/has + V3 + Object</div>
    <div class="tense-example">
      <strong>Example:</strong> I have seen that movie three times.
    </div>
    <div class="tense-usage">
      Used for experiences, changes, continuing situations <br>
      <button class="exercise-btn" onclick="generateExercise('Present Perfect')">B√†i t·∫≠p</button>
    </div>
  </div>

  <!-- Present Perfect Continuous -->
<div class="tense-card">
  <div id="exercise-box"></div>
  <div class="tense-header">
    <h3 class="tense-title">Present Perfect Continuous</h3>
    <div class="tense-icon">4</div>
  </div>
  <div class="tense-formula">Subject + have/has been + V-ing + Object</div>
  <div class="tense-example">
    <strong>Example:</strong> I have been learning English for five years.
  </div>
  <div class="tense-usage">
    Used for actions continuing from the past until now <br>
    <button class="exercise-btn" onclick="generateExercise('Present Perfect Continuous')">B√†i t·∫≠p</button>
    <div class="exercise-buttons">
  <button class="finish-btn">Ho√†n th√†nh</button>
  <button class="retry-btn" style="display:none;">L√†m l·∫°i</button>
</div>
  </div>
</div>

  <!-- Past Tenses -->
  <div class="tense-card">
    <div id="exercise-box"></div>
    <div class="tense-header">
      <h3 class="tense-title">Past Simple</h3>
      <div class="tense-icon">5</div>
    </div>
    <div class="tense-formula">Subject + V2 + Object</div>
    <div class="tense-example">
      <strong>Example:</strong> I went to school yesterday.
    </div>
    <div class="tense-usage">
      Used for completed actions in the past <br>
      <button class="exercise-btn" onclick="generateExercise('Past Simple')">B√†i t·∫≠p</button>
    </div>
  </div>

  <!-- Past Continuous -->
  <div class="tense-card">
    <div id="exercise-box"></div>
    <div class="tense-header">
      <h3 class="tense-title">Past Continuous</h3>
      <div class="tense-icon">6</div>
    </div>
    <div class="tense-formula">Subject + was/were + V-ing + Object</div>
    <div class="tense-example">
      <strong>Example:</strong> She was cooking when I arrived.
    </div>
    <div class="tense-usage">
      Used for actions in progress at a specific time in the past <br>
      <button class="exercise-btn" onclick="generateExercise('Past Continuous')">B√†i t·∫≠p</button>
    </div>
  </div>

  <!-- Past Perfect -->
<div class="tense-card">
  <div id="exercise-box"></div>
  <div class="tense-header">
    <h3 class="tense-title">Past Perfect</h3>
    <div class="tense-icon">7</div>
  </div>
  <div class="tense-formula">Subject + had + V3 + Object</div>
  <div class="tense-example">
    <strong>Example:</strong> She had finished her homework before dinner.
  </div>
  <div class="tense-usage">
    Used for actions completed before another past action or time <br>
    <button class="exercise-btn" onclick="generateExercise('Past Perfect')">B√†i t·∫≠p</button>
  </div>
</div>

<!-- Past Perfect Continuous -->
<div class="tense-card">
  <div id="exercise-box"></div>
  <div class="tense-header">
    <h3 class="tense-title">Past Perfect Continuous</h3>
    <div class="tense-icon">8</div>
  </div>
  <div class="tense-formula">Subject + had been + V-ing + Object</div>
  <div class="tense-example">
    <strong>Example:</strong> They had been studying for two hours before the break.
  </div>
  <div class="tense-usage">
    Used for ongoing actions before another past action or time <br>
    <button class="exercise-btn" onclick="generateExercise('Past Perfect Continuous')">B√†i t·∫≠p</button>
  </div>
</div>

  <!-- Future Simple -->
  <div class="tense-card">
    <div id="exercise-box"></div>
    <div class="tense-header">
      <h3 class="tense-title">Future Simple</h3>
      <div class="tense-icon">9</div>
    </div>
    <div class="tense-formula">Subject + will + V1 + Object</div>
    <div class="tense-example">
      <strong>Example:</strong> They will travel to Paris next year.
    </div>
    <div class="tense-usage">
      Used for predictions, promises, future plans <br>
      <button class="exercise-btn" onclick="generateExercise('Future Simple')">B√†i t·∫≠p</button>
    </div>
  </div>

  <!-- Future Continuous -->
  <div class="tense-card">
    <div id="exercise-box"></div>
    <div class="tense-header">
      <h3 class="tense-title">Future Continuous</h3>
      <div class="tense-icon">10</div>
    </div>
    <div class="tense-formula">Subject + will be + V-ing + Object</div>
    <div class="tense-example">
      <strong>Example:</strong> This time next week, I will be traveling to Japan.
    </div>
    <div class="tense-usage">
      Used for actions that will be in progress at a specific time in the future <br>
      <button class="exercise-btn" onclick="generateExercise('Future Continuous')">B√†i t·∫≠p</button>
    </div>
  </div>

  <!-- Future Perfect -->
  <div class="tense-card">
    <div id="exercise-box"></div>
    <div class="tense-header">
      <h3 class="tense-title">Future Perfect</h3>
      <div class="tense-icon">11</div>
    </div>
    <div class="tense-formula">Subject + will have + V3 + Object</div>
    <div class="tense-example">
      <strong>Example:</strong> By 2025, I will have graduated from university.
    </div>
    <div class="tense-usage">
      Used for actions that will be completed before a specific time in the future <br>
      <button class="exercise-btn" onclick="generateExercise('Future Perfect')">B√†i t·∫≠p</button>
    </div>
  </div>

  <!-- Future Perfect Continuous -->
  <div class="tense-card">
    <div id="exercise-box"></div>
    <div class="tense-header">
      <h3 class="tense-title">Future Perfect Continuous</h3>
      <div class="tense-icon">12</div>
    </div>
    <div class="tense-formula">Subject + will have been + V-ing + Object</div>
    <div class="tense-example">
      <strong>Example:</strong> By next month, she will have been working here for two years.
    </div>
    <div class="tense-usage">
      Used for actions continuing up to a specific time in the future <br>
      <button class="exercise-btn" onclick="generateExercise('Future Perfect Continuous')">B√†i t·∫≠p</button>
    </div>
  </div>
</div>
<!-- Hi·ªáu ·ª®ng Khi Xong B√†i T·∫≠p-->
<div id="result-modal">
  <div class="result-box">
    <h2>K·∫øt th√∫c b√†i t·∫≠p!</h2>
    <p id="score-text">B·∫°n ƒë∆∞·ª£c 0/20 ƒëi·ªÉm üéâ</p>
    <button id="retry-btn" class="result-btn">L√†m l·∫°i</button>
    <button id="exit-btn" class="result-btn">Tho√°t</button>
  </div>
</div>

<!-- Tr√≤ ch∆°i t·ª´ v·ª±ng -->
    <div id="vocab-games" class="content-section">
      <h2>Tr√≤ ch∆°i t·ª´ v·ª±ng</h2>
      <div class="vocab-game-grid">
        <div class="game-box">
          <div class="game-icon"><img src="https://cdn-icons-png.flaticon.com/128/15128/15128933.png"/></div>
          <div class="game-label">Nhi·ªÅu l·ª±a ch·ªçn</div>      
        </div> 
          <div class="game-box" onclick="openGuessWord()">
          <div class="game-icon"><img src="https://cdn-icons-png.flaticon.com/128/10829/10829660.png"/></div>
          <div class="game-label">ƒêo√°n t·ª´</div>
        </div>
        <div class="game-box">
          <div class="game-icon"><img src="https://cdn-icons-png.flaticon.com/128/14682/14682677.png"/></div>
          <div class="game-label">B·∫£ng ƒëi·ªÅu khi·ªÉn</div>
        </div>
      </div>
    </div>

<!--Tr√≤ Ch∆°i Nhi·ªÅu L·ª±a Ch·ªçn-->
<div id="multiple-choice-area" 
    style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:#fff; z-index:9999; padding:2rem; overflow-y:auto;">
  <button onclick="closeMultipleChoice()" style="position:absolute;top:18px;left:18px;font-size:1.5rem;background:none;border:none;cursor:pointer;">
    <img src="https://cdn-icons-png.flaticon.com/128/25/25409.png" alt="Back" style="width:28px;height:28px;vertical-align:middle;">
  </button>
  <h2 style="margin-left:2.5rem;">Tr√≤ ch∆°i nhi·ªÅu l·ª±a ch·ªçn</h2>
  <div id="mc-question" 
  style="font-size:1.5rem; margin:2rem 0; font-weight:bold; color:#1565c0; text-align:center;"></div>
  <div id="mc-options"></div>
  <div style="margin-top:1.5rem;">
    <button id="mc-retry" class="btn-next" style="display:none; margin-right:10px;" onclick="retryQuestion()">L·∫∑p l·∫°i</button>
    <button id="mc-next" class="btn-next" style="display:none;" onclick="nextQuestion()">Ti·∫øp theo</button>
  </div>
</div>

<!-- ƒêO√ÅN T·ª™ -->
<div id="guess-word-area" 
     style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:#fff; z-index:9999; padding:2rem; overflow-y:auto;">
  <button onclick="closeGuessWord()" style="position:absolute;top:18px;left:18px;font-size:1.5rem;background:none;border:none;cursor:pointer;">
    <img src="https://cdn-icons-png.flaticon.com/128/25/25409.png" alt="Back" style="width:28px;height:28px;vertical-align:middle;">
  </button>
  <h2 style="margin-left:2.5rem;">Tr√≤ ch∆°i ƒëo√°n t·ª´</h2>
  <div id="gw-question" style="font-size:1.5rem; margin:2rem 0; font-weight:bold; color:#1565c0; text-align:center;"></div>
  <div id="gw-options"></div>
  <div style="margin-top:1.5rem; text-align:center;">
    <button id="gw-retry" class="btn-next" style="display:none; margin-right:10px;" onclick="retryGuessWord()">L·∫∑p l·∫°i</button>
    <button id="gw-next" class="btn-next" style="display:none;" onclick="nextGuessWord()">Ti·∫øp theo</button>
  </div>
</div>

<!--B·∫£ng ƒëo√°n t·ª´-->
<div id="control-board-area" 
     style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:#fff; z-index:9999; padding:2rem; overflow-y:auto;">
  <button onclick="closeControlBoard()" style="position:absolute;top:18px;left:18px;font-size:1.5rem;background:none;border:none;cursor:pointer;">
    <img src="https://cdn-icons-png.flaticon.com/128/25/25409.png" alt="Back" style="width:28px;height:28px;vertical-align:middle;">
  </button>
  <h2 style="margin-left:2.5rem;">Tr√≤ ch∆°i b·∫£ng ƒëi·ªÅu khi·ªÉn</h2>
  <div id="cb-grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-top:2rem;"></div>
  <div id="cb-pronunciation" style="text-align:center;font-size:1.2rem;color:#1565c0;margin-top:1.5rem;"></div>
  <div id="cb-actions" style="display:none; text-align:center; margin-top:1.5rem;">
  <button onclick="repeatControlBoard()" 
    style="padding:0.5rem 1rem; margin-right:10px; border:none; border-radius:6px; background:#2196f3; color:#fff; cursor:pointer;">
    üîÅ L·∫∑p l·∫°i
  </button>
  <button onclick="nextControlBoard()" 
    style="padding:0.5rem 1rem; border:none; border-radius:6px; background:#4caf50; color:#fff; cursor:pointer;">
    ‚è≠ Ti·∫øp theo
  </button>
</div>
</div>

    <!-- T√†i kho·∫£n c·ªßa t√¥i-->
    <div id="account" class="content-section">
  <h2>ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</h2>

  <form id="registerForm" style="display:none; margin-top:1rem;">
    <input type="text" id="fullname" placeholder="H·ªç v√† t√™n" required><br><br>
    <input type="text" id="nickname" placeholder="Nickname" required><br><br>
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u" required><br><br>
    <input type="password" id="confirmPassword" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u" required><br><br>
    <button type="button" onclick="register()">ƒêƒÉng k√Ω</button>
    <p>B·∫°n ƒë√£ c√≥ t√†i kho·∫£n? 
      <a href="#" onclick="toggleForms('login')">ƒêƒÉng nh·∫≠p</a>
    </p>
  </form>

  <form id="loginForm" style="margin-top:1rem;">
    <input type="text" id="loginNickname" placeholder="Nickname" required><br><br>
    <input type="password" id="loginPassword" placeholder="M·∫≠t kh·∫©u" required><br><br>
    <button type="button" onclick="login()">ƒêƒÉng nh·∫≠p</button>
    <p>Ch∆∞a c√≥ t√†i kho·∫£n? 
      <a href="#" onclick="toggleForms('register')">ƒêƒÉng k√Ω</a>
    </p>
  </form>
</div>

    <div id="level" class="content-section">
  <h2>Kh√≥a h·ªçc c·ªßa t√¥i</h2>
  <button onclick="logout()" style="margin:10px 0; padding:8px 12px; background:#e53935; color:#fff; border:none; border-radius:6px; cursor:pointer;">
    ƒêƒÉng xu·∫•t
  </button>
  <div class="level-grid">
        <div class="level-box">
          <div class="level-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/4217/4217979.png"/>
          </div>
          <div class="level-label">Ti·∫øn tr√¨nh</div>
        </div>

        <div class="level-box">
          <div class="level-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/1362/1362090.png"/>
          </div>
          <div class="level-label">L·ªói sai hay g·∫∑p</div>
        </div>

        <div class="level-box">
          <div class="level-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/5402/5402323.png"/>
          </div>
          <div class="level-label">T·ª´ v·ª±ng ƒë√£ h·ªçc</div>
        </div>

        <div class="level-box">
          <div class="level-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/3135/3135722.png"/>
          </div>
          <div class="level-label">Th√†nh t·ª±u</div>
        </div>

        <div class="level-box">
          <div class="level-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/3330/3330300.png"/>
          </div>
          <div class="level-label">B√†i h·ªçc</div>
        </div>
      </div>
    </div>


<!-- Thanh h·ªó tr·ª£ m·ªü r·ªông t·ª´ v·ª±ng -->
    <div id="definitionPage" class="definition-page content-section">
  <div class="top-tab-bar">
    <button class="tab-item active" data-tab="vi">ANH - VI·ªÜT</button>
    <button class="tab-item" data-tab="grammar">NG·ªÆ PH√ÅP</button>
    <button class="tab-item" data-tab="en">ƒê·ªíNG NGHƒ®A/TR√ÅI NGHƒ®A</button> 
    <button class="tab-item" data-tab="field">GI·∫¢I NGHƒ®A</button>
  </div>

  <!-- ANH - VI·ªÜT -->
  <div id="tab-vi" class="tab-content">
    <h2 id="wordMeaning">Meaning</h2>
    <p id="wordPronunciation">Pronunciation:</p>
    <p id="wordLevel">Level:</p>
    <div id="wordExamples" class="examples">Examples:</div>
    <button onclick="goBack()">Quay l·∫°i</button>
  </div>

  <!-- C√°c tab kh√°c -->
  <div id="tab-grammar" class="tab-content" style="display: none;">
  <h3>Ng·ªØ ph√°p</h3>

  <!-- Family Words -->
  <h4>Family Words</h4>
  <ul>
    <li>Noun: <span id="familyNoun"></span></li>
    <li>Verb: <span id="familyVerb"></span></li>
    <li>Adjective: <span id="familyAdjective"></span></li>
    <li>Adverb: <span id="familyAdverb"></span></li>
  </ul>

  <!-- Tenses -->
  <h4>Tenses</h4>
  <ul>
    <li>Present Simple: <span id="presentSimple"></span></li>
    <li>Past Simple: <span id="pastSimple"></span></li>
    <li>Future Simple: <span id="futureSimple"></span></li>
    <li>Present Continuous: <span id="presentContinuous"></span></li>
    <li>Past Continuous: <span id="pastContinuous"></span></li>
    <li>Future Continuous: <span id="futureContinuous"></span></li>
    <li>Present Perfect: <span id="presentPerfect"></span></li>
    <li>Past Perfect: <span id="pastPerfect"></span></li>
    <li>Future Perfect: <span id="futurePerfect"></span></li>
  </ul>
</div>

  <div id="tab-en" class="tab-content" style="display: none;">
    <h3>ƒê·ªìng nghƒ©a/Tr√°i nghƒ©a</h3> 
    <div id="synonyms-content">Ch·ªçn t·ª´ ƒë·ªÉ xem ƒë·ªìng nghƒ©a/tr√°i nghƒ©a.</div>
</div>

  <div id="tab-field" class="tab-content" style="display: none;">
    <h3>GI·∫¢I NGHƒ®A</h3>
    <div id="specialized-content">Ch·ªçn t·ª´ ƒë·ªÉ xem gi·∫£i nghƒ©a.</div> 
  </div>
</div>

<!--C√ÇU-->
<div id="expression-area" style="display:none; position:fixed; top:0; left:220px; width:calc(100vw - 220px); height:100vh; background:#fff; box-shadow:none; z-index:9999; overflow-y:auto; padding:2rem;">
  <button onclick="closeExpression()" style="position:absolute;top:18px;left:18px;font-size:1.5rem;background:none;border:none;cursor:pointer;">
    <img src="https://cdn-icons-png.flaticon.com/128/25/25409.png" alt="Back" style="width:28px;height:28px;vertical-align:middle;">
  </button>
  <h2 style="margin-left:2.2rem;">Bi·ªÉu hi·ªán ti·∫øng Anh th√¥ng d·ª•ng</h2>
  <div id="expression-list"></div>
</div>

<div id="sentence" class="content-section"> 
      <h2>C√¢u</h2>
     <div class="sentence-grid">
        <div class="sentence-box" onclick="showExpressions('Bi·ªÉu hi·ªán')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/3715/3715830.png"/>
          </div>
          <div class="sentence-label">Bi·ªÉu hi·ªán</div>
        </div>

        <div class="sentence-box" onclick="showExpressions('C∆° th·ªÉ v√† s·ª©c kh·ªèe')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/17683/17683051.png"/>
          </div>
          <div class="sentence-label">C∆° th·ªÉ v√† s·ª©c kh·ªèe</div>
        </div>
        
       <div class="sentence-box" onclick="showExpressions('Gia ƒë√¨nh')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/437/437522.png" />
          </div> 
          <div class="sentence-label">Gia ƒë√¨nh</div>
      </div>

        <div class="sentence-box" onclick="showExpressions('Th·ª©c ƒÉn')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/562/562678.png"/>
          </div>
          <div class="sentence-label">Th·ª©c ƒÉn</div>
        </div>

        <div class="sentence-box" onclick="showExpressions('Nh√†')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/2413/2413074.png"/>
          </div>
          <div class="sentence-label">Nh√†</div>
        </div>

        <div class="sentence-box" onclick="showExpressions('ƒê·ªãa ƒëi·ªÉm')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/535/535239.png"/>
          </div>
          <div class="sentence-label">ƒê·ªãa ƒëi·ªÉm</div>
        </div>

        <div class="sentence-box" onclick="showExpressions('C√¢u h·ªèi')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/942/942802.png"/>
          </div>
          <div class="sentence-label">C√¢u h·ªèi</div>
        </div>

        <div class="sentence-box" onclick="showExpressions('Mua s·∫Øm')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/3081/3081415.png"/>
          </div>
          <div class="sentence-label">Mua s·∫Øm</div>
        </div>

        <div class="sentence-box" onclick="showExpressions('Th·ªÉ thao')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/4163/4163679.png"/>
          </div>
          <div class="sentence-label">Th·ªÉ thao</div>
        </div>

        <div class="sentence-box" onclick="showExpressions('Nghi√™n c·ª©u')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/5531/5531648.png"/>
          </div>
          <div class="sentence-label">Nghi√™n c·ª©u</div>
        </div>

        <div class="sentence-box" onclick="showExpressions('V·∫≠n chuy·ªÉn')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/17865/17865314.png"/>
          </div>
          <div class="sentence-label">V·∫≠n chuy·ªÉn</div>
        </div>

        <div class="sentence-box" onclick="showExpressions('Du l·ªãch')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/5333/5333434.png"/>
          </div>
          <div class="sentence-label">Du l·ªãch</div>
        </div>

        <div class="sentence-box" onclick="showExpressions('Th·ªùi ti·∫øt')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/3406/3406977.png"/>
          </div>
          <div class="sentence-label">Th·ªùi ti·∫øt</div>
        </div>

        <div class="sentence-box" onclick="showExpressions('C√¥ng vi·ªác')">
          <div class="sentence-icon">
          <img src="https://cdn-icons-png.flaticon.com/128/3150/3150573.png"/>
          </div>
          <div class="sentence-label">C√¥ng vi·ªác</div>
        </div>
      </div>
    </div>

    <!--Flash Card-->
    <div id="card" class="content-section">
  <h2>Flash Card</h2>
  <div id="flashcard-container" style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-top:1rem;"></div>
</div>

<div id="sentence-games" class="content-section" style="margin:0; padding:0;">
  <iframe 
    src="filling-game.html" 
    style="width:100%; height:100vh; border:none; margin:0; display:block;">
  </iframe>
</div>



  <script>
  /*T·ª´ v·ª±ng*/
    const vocabulary = [
      { eng: 'Good morning', vn: 'Ch√†o bu·ªïi s√°ng', pronunciation: '/Àå…° äd Ààm…îÀê.n…™≈ã/ interjection', level: 'A1', examples: ['Good morning, how are you today?'] },
      { eng: 'Good afternoon', vn: 'Ch√†o bu·ªïi chi·ªÅu', pronunciation: '/Àå…° äd Àå…ëÀêf.t…ôÀànuÀên/ interjection', level: 'A1', examples: ['Good afternoon, everyone.'] },
      { eng: 'Good evening', vn: 'Ch√†o bu·ªïi t·ªëi', pronunciation: '/Àå…° äd ÀàiÀêv.n…™≈ã/ interjection', level: 'A1', examples: ['Good evening! Did you have a good day?'] },
      { eng: 'Hello', vn: 'Xin ch√†o, ch√†o', pronunciation: '/heÀàl…ô ä/ interjection, noun', level: 'A1', examples: ['Hello, my friend!', 'Say hello to your mom for me.'] },
      { eng: 'Hi', vn: 'Xin ch√†o, ch√†o', pronunciation: '/ha…™/ interjection', level: 'A1', examples: ['Hi, how are you?', 'Hi there!'] },
      { eng: 'Welcome', vn: 'Xin m·ªùi v√†o, ch√†o m·ª´ng', pronunciation: '/Ààwelk…ôm/ interjection', level: 'A1', examples: ['Welcome to our home.', 'Welcome back!'] },
      { eng: 'House', vn: 'Nh√† ·ªü, cƒÉn nh√†', pronunciation: '/ha äs/ noun', level: 'A1', examples: ['My house has two bedrooms.', 'They live in a big house.'] },
      { eng: 'Home', vn: 'Nh√† ·ªü, t·ªï ·∫•m', pronunciation: '/h…ô äm/ noun', level: 'A1', examples: ['She is at home now.', 'I feel safe at home.'] },
      { eng: 'Room', vn: 'Ph√≤ng', pronunciation: '/ruÀêm/ noun', level: 'A1', examples: ['This is my favorite room.', 'How many rooms are in your house?'] },
      { eng: 'Living room', vn: 'Ph√≤ng kh√°ch', pronunciation: '/Ààl…™v…™≈ã ruÀêm/ noun', level: 'A1', examples: ['We watch TV in the living room.', 'The living room is big.'] },
      { eng: 'Bathroom', vn: 'Ph√≤ng t·∫Øm', pronunciation: '/Ààb…ëÀêŒ∏ruÀêm/ noun', level: 'A1', examples: ['The bathroom is clean.', 'He is in the bathroom.'] },
      { eng: 'Bedroom', vn: 'Ph√≤ng ng·ªß', pronunciation: '/ÀàbedruÀêm/ noun', level: 'A1', examples: ['This is my bedroom.', 'Her bedroom is pink.'] },
      { eng: 'Dining room', vn: 'Ph√≤ng ƒÉn', pronunciation: '/Ààda…™n…™≈ã ruÀêm/ noun', level: 'A1', examples: ['We have dinner in the dining room.', 'The dining room has a big table.'] },
      { eng: 'Kitchen', vn: 'Nh√† b·∫øp', pronunciation: '/Ààk…™t É…™n/ noun', level: 'A1', examples: ['I cook in the kitchen.', 'The kitchen is small.'] },
      { eng: 'Library', vn: 'Th∆∞ vi·ªán t·∫°i gia', pronunciation: '/Ààla…™br…ôri/ noun', level: 'A1', examples: ['She studies in the library.', 'This library has many books.'] },
      { eng: 'Office', vn: 'Ph√≤ng l√†m vi·ªác', pronunciation: '/Àà…íf…™s/ noun', level: 'A1', examples: ['He works in his home office.', 'My office is quiet.'] },
      { eng: 'Sofa', vn: 'Gh·∫ø sofa', pronunciation: '/Ààs…ô äf…ô/ noun', level: 'A1', examples: ['She is sitting on the sofa.', 'This sofa is comfortable.'] },
      { eng: 'Bed', vn: 'Gi∆∞·ªùng', pronunciation: '/bed/ noun', level: 'A1', examples: ['I sleep on the bed.', 'The bed is soft.'] },
      { eng: 'Chair', vn: 'Gh·∫ø', pronunciation: '/t Ée…ô(r)/ noun', level: 'A1', examples: ['He sat on the chair.', 'The chair is made of wood.'] },
      { eng: 'Table', vn: 'B√†n', pronunciation: '/Ààte…™bl/ noun', level: 'A1', examples: ['The books are on the table.', 'We eat at the table.'] },
      { eng: 'Desk', vn: 'B√†n l√†m vi·ªác', pronunciation: '/desk/ noun', level: 'A1', examples: ['Her desk is clean.', 'I study at my desk.'] },
      { eng: 'Picture', vn: 'Tranh ·∫£nh', pronunciation: '/Ààp…™kt É…ô(r)/ noun', level: 'A1', examples: ['There is a picture on the wall.', 'She painted this picture.'] },
      { eng: 'Window', vn: 'C·ª≠a s·ªï', pronunciation: '/Ààw…™nd…ô ä/ noun', level: 'A1', examples: ['The window is open.', 'I can see outside through the window.'] },
      { eng: 'Door', vn: 'C·ª≠a ra v√†o', pronunciation: '/d…îÀêr/ noun', level: 'A1', examples: ['Please close the door.', 'The door is red.'] },
      { eng: 'Floor', vn: 'S√†n nh√†', pronunciation: '/fl…îÀêr/ noun', level: 'A1', examples: ['The floor is made of wood.', 'She cleaned the floor.'] },
      { eng: 'Roof', vn: 'M√°i nh√†', pronunciation: '/ruÀêf/ noun', level: 'A1', examples: ['The roof is blue.', 'They fixed the roof yesterday.'] },
      { eng: 'Garden', vn: 'V∆∞·ªùn, khu v∆∞·ªùn', pronunciation: '/Àà…°…ëÀêdn/ noun', level: 'A1', examples: ['The garden has many flowers.', 'We play in the garden.'] },
      { eng: 'Beat', vn: 'th·∫Øng, ƒë√°nh b·∫°i', pronunciation: '/biÀêt/ v', level: 'B1', examples: ['He beat me at chess.'] },
      { eng: 'Board game', vn: 'tr√≤ ch∆°i tr√™n b√†n c·ªù', pronunciation: '/Ààb…îÀêd …°e…™m/ np', level: 'B1', examples: ['Every Sunday we play Monopoly or some other board game.'] },
      { eng: 'Captain', vn: 'ƒë·ªôi tr∆∞·ªüng, thuy·ªÅn tr∆∞·ªüng', pronunciation: '/Ààk√¶pt…™n/ n', level: 'B1', examples: ['The captain gave the order to abandon ship.'] },
      { eng: 'Challenge', vn: 'th√°ch th·ª©c, s·ª± th√°ch th·ª©c', pronunciation: '/Ààt É√¶l…™nd í/ v, n', level: 'B1', examples: ["The job doesn't really challenge her."] },
      { eng: 'Champion', vn: 'qu√°n qu√¢n', pronunciation: '/Ààt É√¶mpi…ôn/ n', level: 'B1', examples: ['He became the youngest US Open champion for 88 years.'] },
      { eng: 'Cheat', vn: 'l·ª´a, gian l·∫≠n', pronunciation: '/t ÉiÀêt/ v', level: 'B1', examples: ['She is accused of attempting to cheat the taxman.'] },
      { eng: 'Classical', vn: 'c·ªï ƒëi·ªÉn', pronunciation: '/Ààkl√¶s…™kl/ adj', level: 'B1', examples: ['Both Bach and Beethoven wrote classical music.'] },
      { eng: 'Classical', vn: 'c·ªï ƒëi·ªÉn', pronunciation: '/Ààkl√¶s…™kl/ adj', level: 'B1', examples: ['Both Bach and Beethoven wrote classical music.'] },
      { eng: 'Club', vn: 'c√¢u l·∫°c b·ªô', pronunciation: '/kl åb/ n', level: 'A2', examples: ['They belong to the same golf club.'] },
      { eng: 'Coach', vn: 'hu·∫•n luy·ªán vi√™n', pronunciation: '/k…ô ät É/ n', level: 'A2', examples: ['He is a former college football coach.'] },
      { eng: 'Competition', vn: 'cu·ªôc thi ƒë·∫•u', pronunciation: '/Àåk…ímp…ôÀàt…™ Én/ n', level: 'A2', examples: ['Hundreds of schools entered the competition.'] },
      { eng: 'Concert', vn: 'bu·ªïi h√≤a nh·∫°c', pronunciation: '/Ààk…íns…ôt/ n', level: 'A2', examples: ['The orchestra gave a concert in Miami in January.'] },
      { eng: 'Defeat', vn: 'ƒë√°nh b·∫°i', pronunciation: '/d…™ÀàfiÀêt/ v', level: 'B1', examples: ['It was said that he could not be defeated in battle.'] },
      { eng: 'Entertaining', vn: 'gi·∫£i tr√≠', pronunciation: '/Àåent…ôÀàte…™n…™≈ã/ adj', level: 'B1', examples: ['I found the talk both informative and entertaining.'] },
      { eng: 'Group', vn: 'nh√≥m', pronunciation: '/…°ruÀêp/ n', level: 'A1', examples: ['A group of us are going to the theatre this evening.'] },
      { eng: 'Gym', vn: 'ph√≤ng t·∫≠p th·ªÉ d·ª•c', pronunciation: '/d í…™m/ n', level: 'A1', examples: ['The school has recently built a new gym.'] },
      { eng: 'Interest', vn: 's·ª± th√≠ch th√∫', pronunciation: '/Àà…™ntr…ôst/ v, n', level: 'A2', examples: ['Do your parents take an interest in your friends?'] },
      { eng: 'Member', vn: 'th√†nh vi√™n', pronunciation: '/Ààmemb…ôr/ n', level: 'A1', examples: ['He is an important member of our team.'] },
      { eng: 'Opponent', vn: 'ƒë·ªëi th·ªß', pronunciation: '/…ôÀàp…ô än…ônt/ n', level: 'B1', examples: ['He has knocked out 15 opponents in 20 fights.'] },
      { eng: 'Organise', vn: 's·∫Øp x·∫øp, t·ªï ch·ª©c', pronunciation: '/Àà…îÀê…°…ôna…™z/ v', level: 'A2', examples: ['He helped to organize various events.'] },
      { eng: 'Pleasure', vn: 'ni·ªÅm vui', pronunciation: '/Ààple í…ôr/ n', level: 'B1', examples: ['Children find endless pleasure in playing with water.'] },
      { eng: 'Referee', vn: 'tr·ªçng t√†i', pronunciation: '/Àåref…ôÀàriÀê/ n', level: 'B1', examples: ['He was sent off for arguing with the referee.'] },
      { eng: 'Rhythm', vn: 'nh·ªãp, √¢m ti·∫øt', pronunciation: '/Ààr…™√∞…ôm/ n', level: 'B1', examples: ['I listened to the steady rhythm of her breathing.'] },
      { eng: 'Risk', vn: 'r·ªßi ro', pronunciation: '/r…™sk/ v, n', level: 'B1', examples: ['He risked his life to save her.'] },
      { eng: 'Score', vn: 'ghi ƒëi·ªÉm, ƒëi·ªÉm s·ªë', pronunciation: '/sk…îÀêr/ v, n', level: 'A2', examples: ['He scored 20 points in 36 minutes.'] },
      { eng: 'Support', vn: 'h·ªó tr·ª£, ·ªßng h·ªô, s·ª± ·ªßng h·ªô', pronunciation: '/s…ôÀàp…îÀêt/ v, n', level: 'A2', examples: ["If you raise it at the meeting, I'll support you."] },
      { eng: 'Team', vn: 'ƒë·ªôi', pronunciation: '/tiÀêm/ n', level: 'A1', examples: ['They play volleyball for the national team.'] },
      { eng: 'Train', vn: 'hu·∫•n luy·ªán, ƒë√†o t·∫°o', pronunciation: '/tre…™n/ v', level: 'A2', examples: ['All members of the team have trained in first aid.'] },
      { eng: 'Fun', vn: 'vui, tr√≤ vui', pronunciation: '/f ån/ n', level: 'A1', examples: ["We had a lot of fun at Sarah's party."] },
      { eng: 'Carry on', vn: 'ti·∫øp t·ª•c', pronunciation: '/Ààk√¶ri …ín/ v', level: 'B1', examples: ['Carry on until you get to the junction, then turn left.'] },
      { eng: 'Eat out', vn: 'ƒÉn ngo√†i (·ªü nh√† h√†ng)', pronunciation: '/iÀêt a ät/ v', level: 'A2', examples: ['Do you feel like eating out tonight?'] },
      { eng: 'Give up', vn: 't·ª´ b·ªè', pronunciation: '/…°…™v  åp/ v', level: 'B1', examples: ['They gave up without a fight.'] },
      { eng: 'Join in', vn: 'tham gia', pronunciation: '/d í…î…™n …™n/ v', level: 'B1', examples: ['She listens but she never joins in.'] },
      { eng: 'Send off', vn: 'ƒëu·ªïi ra kh·ªèi s√¢n ch∆°i', pronunciation: '/send …íf/ v', level: 'B1', examples: ['Bale was sent off for a foul in the second half.'] },
      { eng: 'Take up', vn: 'b·∫Øt ƒë·∫ßu m·ªôt s·ªü th√≠ch', pronunciation: '/te…™k  åp/ v', level: 'B1', examples: ["They've taken up golf."] },
      { eng: 'Turn down', vn: 'gi·∫£m √¢m l∆∞·ª£ng', pronunciation: '/t…úÀên da än/ v', level: 'A2', examples: ['Please turn the volume down.'] },
      { eng: 'Turn up', vn: 'tƒÉng √¢m l∆∞·ª£ng', pronunciation: '/t…úÀên  åp/ v', level: 'A2', examples: ['Please turn the volume up.'] },
      { eng: 'For a long time', vn: 'l√¢u, r·∫•t l√¢u', pronunciation: '/f…îÀêr …ô l…í≈ã ta…™m/', level: 'A2', examples: ['I have been waiting for a long time.'] },
      { eng: 'For fun', vn: 'cho vui, kh√¥ng nghi√™m t√∫c', pronunciation: '/f…îÀêr f ån/', level: 'A2', examples: ['I just work for fun.'] },
      { eng: 'In the middle (of)', vn: '·ªü gi·ªØa c√°i g√¨', pronunciation: '/…™n √∞…ô Ààm…™dl …ív/', level: 'A2', examples: ['Her car was stuck in the middle of the road.'] },
      { eng: 'In time (for)', vn: 'ƒë√∫ng gi·ªù', pronunciation: '/…™n ta…™m f…îÀêr/', level: 'B1', examples: ["Will we be in time for the six o'clock train?"] },
      { eng: 'On CD/DVD/video', vn: 'tr√™n ƒëƒ©a CD, video', pronunciation: '/…ín ÀåsiÀêÀàdiÀê, ÀådiÀêviÀêÀàdiÀê, Ààv…™di…ô ä/', level: 'A2', examples: ['The robbery was captured on video.'] },
      { eng: 'On stage', vn: 'tr√™n s√¢n kh·∫•u', pronunciation: '/…ín ste…™d í/', level: 'A2', examples: ['There were more than 50 people on stage in one scene.'] },
      { eng: 'On the stage', vn: 'tr·ªü th√†nh di·ªÖn vi√™n', pronunciation: '/…ín √∞…ô ste…™d í/', level: 'B1', examples: ['Her daughter is an artist and her son is on the stage.'] },
      { eng: 'At the end of', vn: 'v√†o cu·ªëi c·ªßa c√°i g√¨', pronunciation: '/√¶t √∞i end …ív/', level: 'A2', examples: ['At the end of the day, we all want to be happy.'] },
      { eng: 'At first', vn: 'l√∫c ƒë·∫ßu', pronunciation: '/√¶t f…úÀêst/', level: 'A2', examples: ['At first, I didn‚Äôt like it, but now I love it.'] },
      { eng: 'At last', vn: 'cu·ªëi c√πng', pronunciation: '/√¶t l…ëÀêst/', level: 'A2', examples: ['At last, we have some good news!'] },
      { eng: 'In a way', vn: 'theo m·ªôt c√°ch n√†o ƒë√≥', pronunciation: '/…™n …ô we…™/', level: 'B1', examples: ['In a way, I agree with you.'] },
      { eng: 'In my opinion', vn: 'theo √Ω ki·∫øn c·ªßa t√¥i', pronunciation: '/…™n ma…™ …ôÀàp…™nj…ôn/', level: 'A2', examples: ['In my opinion, this is the best solution.'] },
      { eng: 'In public', vn: 'tr∆∞·ªõc c√¥ng ch√∫ng', pronunciation: '/…™n Ààp åbl…™k/', level: 'A2', examples: ['He never speaks in public.'] },
      { eng: 'In private', vn: 'ri√™ng t∆∞, kh√¥ng c√¥ng khai', pronunciation: '/…™n Ààpra…™v…ôt/', level: 'B1', examples: ['She prefers to discuss matters in private.'] },
      { eng: 'In the end', vn: 'cu·ªëi c√πng', pronunciation: '/…™n √∞i end/', level: 'A2', examples: ['In the end, we decided to go.'] },
      { eng: 'On purpose', vn: 'c·ªë √Ω', pronunciation: '/…ín Ààp…úÀêp…ôs/', level: 'B1', examples: ['Did you do that on purpose?'] },
      { eng: 'Out of date', vn: 'h·∫øt h·∫°n, l·ªói th·ªùi', pronunciation: '/a ät …ív de…™t/', level: 'B1', examples: ['This information is out of date.'] },
      { eng: 'Out of order', vn: 'h·ªèng, kh√¥ng ho·∫°t ƒë·ªông', pronunciation: '/a ät …ív Àà…îÀêd…ô(r)/', level: 'B1', examples: ['The lift is out of order.'] },
      { eng: 'Out of practice', vn: 'kh√¥ng c√≤n th·ª±c h√†nh, kh√¥ng c√≤n luy·ªán t·∫≠p n·ªØa', pronunciation: '/a ät …ív Ààpr√¶kt…™s/', level: 'B1', examples: ['I‚Äôm a bit out of practice at tennis.'] },
      { eng: 'Out of work', vn: 'th·∫•t nghi·ªáp, kh√¥ng c√≥ vi·ªác l√†m', pronunciation: '/a ät …ív w…úÀêk/', level: 'B1', examples: ['He has been out of work for six months.'] },
      { eng: 'Take it easy', vn: 'th∆∞ gi√£n, ngh·ªâ ng∆°i', pronunciation: '/te…™k …™t ÀàiÀêzi/', level: 'A2', examples: ['You should take it easy for a few days.'] },
      { eng: 'Take it in turns (to do something)', vn: 'l·∫ßn l∆∞·ª£t l√†m g√¨ ƒë√≥', pronunciation: '/te…™k …™t …™n t…úÀênz t…ô duÀê Ààs åmŒ∏…™≈ã/', level: 'B1', examples: ['We take it in turns to cook dinner.'] },
      { eng: 'Take it or leave it', vn: 'nh·∫≠n l·∫•y ho·∫∑c kh√¥ng', pronunciation: '/te…™k …™t …îÀê liÀêv …™t/', level: 'B1', examples: ['This is my final offer, take it or leave it.'] },
      { eng: 'Take notice of', vn: 'ch√∫ √Ω ƒë·∫øn', pronunciation: '/te…™k Ààn…ô ät…™s …ív/', level: 'B1', examples: ['You should take notice of the warning signs.'] },
      { eng: 'Take part in', vn: 'tham gia v√†o', pronunciation: '/te…™k p…ëÀêt …™n/', level: 'A2', examples: ['She wants to take part in the competition.'] },
      { eng: 'Take place', vn: 'di·ªÖn ra, x·∫£y ra', pronunciation: '/te…™k ple…™s/', level: 'A2', examples: ['The meeting will take place next week.'] },
      { eng: 'Take time off (work)', vn: 'ngh·ªâ l√†m vi·ªác m·ªôt th·ªùi gian', pronunciation: '/te…™k ta…™m …íf w…úÀêk/', level: 'B1', examples: ['I need to take some time off work.'] },
      { eng: 'Take turns (to do something)', vn: 'l·∫ßn l∆∞·ª£t l√†m g√¨ ƒë√≥', pronunciation: '/te…™k t…úÀênz t…ô duÀê Ààs åmŒ∏…™≈ã/', level: 'B1', examples: ['We take turns to cook dinner.'] },
      { eng: 'Take up a hobby', vn: 'b·∫Øt ƒë·∫ßu m·ªôt s·ªü th√≠ch m·ªõi', pronunciation: '/te…™k  åp …ô Ààh…íbi/', level: 'B1', examples: ['I want to take up a new hobby this year.'] },
      { eng: 'Take up time', vn: 'chi·∫øm th·ªùi gian', pronunciation: '/te…™k  åp ta…™m/', level: 'B1', examples: ['This task takes up too much time.'] },
      { eng: 'Take your time', vn: 'd√†nh th·ªùi gian c·ªßa b·∫°n, kh√¥ng v·ªôi v√†ng', pronunciation: '/te…™k j…îÀê ta…™m/', level: 'A2', examples: ['Take your time, there‚Äôs no rush.'] },
      { eng: 'Take your time (doing something)', vn: 'd√†nh th·ªùi gian l√†m g√¨ ƒë√≥', pronunciation: '/te…™k j…îÀê ta…™m duÀê…™≈ã Ààs åmŒ∏…™≈ã/', level: 'B1', examples: ['Take your time doing the homework.'] },
      { eng: 'Take your time to do something', vn: 'd√†nh th·ªùi gian ƒë·ªÉ l√†m g√¨ ƒë√≥', pronunciation: '/te…™k j…îÀê ta…™m t…ô duÀê Ààs åmŒ∏…™≈ã/', level: 'B1', examples: ['Take your time to finish the project.'] },
      { eng: 'Take your time with something', vn: 'd√†nh th·ªùi gian v·ªõi c√°i g√¨ ƒë√≥', pronunciation: '/te…™k j…îÀê ta…™m w…™√∞ Ààs åmŒ∏…™≈ã/', level: 'B1', examples: ['Take your time with the presentation.'] },
      { eng: 'Bored with', vn: 'ch√°n v·ªõi', pronunciation: '/b…îÀêd w…™√∞/', level: 'A2', examples: ['I am bored with the lesson.'] },
      { eng: 'Crazy about', vn: 'say m√™, cu·ªìng', pronunciation: '/Ààkre…™zi …ôÀåba ät/', level: 'A2', examples: ['She is crazy about pop music.'] },
      { eng: 'Good at', vn: 'gi·ªèi v·ªÅ', pronunciation: '/…° äd √¶t/', level: 'A2', examples: ['They are good at English.'] },
      { eng: 'Interested in', vn: 'th√≠ch th√∫', pronunciation: '/Àà…™ntr…ôst…™d …™n/', level: 'A2', examples: ['He is interested in science.'] },
      { eng: 'Keen on', vn: 'say m√™', pronunciation: '/kiÀên …ín/', level: 'B1', examples: ['I am keen on playing volleyball.'] },
      { eng: 'Popular with', vn: 'ph·ªï bi·∫øn v·ªõi', pronunciation: '/Ààp…ípj…ôl…ô w…™√∞/', level: 'B1', examples: ['This area is immensely popular with tourists.'] },
      { eng: 'Feel like', vn: 'th√≠ch, th√®m', pronunciation: '/fiÀêl la…™k/', level: 'A2', examples: ['We feel like going to the supermarket.'] },
      { eng: 'Listen to', vn: 'l·∫Øng nghe', pronunciation: '/Ààl…™sn tuÀê/', level: 'A1', examples: ['I am listening to classical music.'] },
      { eng: 'Take part in', vn: 'tham gia v√†o', pronunciation: '/te…™k p…ëÀêt …™n/', level: 'B1', examples: ['They took part in the singing competition.'] },
      { eng: 'A book (by sb) about', vn: 's√°ch c·ªßa ai vi·∫øt v·ªÅ', pronunciation: '/…ô b äk ba…™ Ààs åmb…ôdi …ôÀàba ät/', level: 'B1', examples: ["He has written a book about the island's rich history."] },
      { eng: 'A fan of', vn: 'ng∆∞·ªùi h√¢m m·ªô', pronunciation: '/…ô f√¶n …ív/', level: 'A2', examples: ["I'm a big fan of her books."] },
      { eng: 'A game against', vn: 'tr·∫≠n ƒë·∫•u v·ªõi', pronunciation: '/…ô …°e…™m …ôÀà…°enst/', level: 'B1', examples: ['The match against Swansea is on Saturday.'] },
      { eng: 'A match between', vn: 'tr·∫≠n ƒë·∫•u gi·ªØa', pronunciation: '/…ô m√¶t É b…™ÀàtwiÀên/', level: 'B1', examples: ['The match between the two teams was exciting.'] },
      { eng: 'A song by sb about', vn: 'b√†i h√°t c·ªßa ai v·ªÅ', pronunciation: '/…ô s…í≈ã ba…™ Ààs åmb…ôdi …ôÀàba ät/', level: 'B1', examples: ['She sang a song about love.'] },
      { eng: 'A story about', vn: 'c√¢u chuy·ªán v·ªÅ', pronunciation: '/…ô Ààst…îÀêri …ôÀàba ät/', level: 'A2', examples: ['He told a story about his childhood.'] },
      { eng: 'A video of', vn: 'video v·ªÅ', pronunciation: '/…ô Ààv…™di…ô ä …ôv/', level: 'B1', examples: ['I watched a video of the concert.'] },
      { eng: 'Be good for you', vn: 't·ªët cho b·∫°n', pronunciation: '/bi …° äd f…îÀê j ä/', level: 'B1', examples: ['Exercise is good for you.'] },
      { eng: 'Be interested in sth/sb/doing sth', vn: 'quan t√¢m ƒë·∫øn c√°i g√¨/ai/l√†m g√¨ ƒë√≥', pronunciation: '/bi Àà…™ntr…ôst…™d …™n Ààs åmŒ∏…™≈ã/Ààs åmb…ôdi/duÀê…™≈ã Ààs åmŒ∏…™≈ã/', level: 'B1', examples: ['I am interested in learning new languages.'] },
      { eng: 'Be keen to do sth', vn: 'r·∫•t mu·ªën l√†m g√¨ ƒë√≥', pronunciation: '/bi kiÀên t…ô duÀê Ààs åmŒ∏…™≈ã/', level: 'B1', examples: ['She is keen to join the club.'] },
      { eng: 'Be popular with sb', vn: 'ƒë∆∞·ª£c y√™u th√≠ch b·ªüi ai ƒë√≥', pronunciation: '/bi Ààp…ípj…ôl…ô w…™√∞ Ààs åmb…ôdi/', level: 'B1', examples: ['This restaurant is popular with locals.'] },
      { eng: 'Be tired of sth/sb/doing sth', vn: 'ch√°n ng·∫•y c√°i g√¨/ai/l√†m g√¨ ƒë√≥', pronunciation: '/bi ta…™…ôd …ív Ààs åmŒ∏…™≈ã/Ààs åmb…ôdi/duÀê…™≈ã Ààs åmŒ∏…™≈ã/', level: 'B1', examples: ['I am tired of waiting for him.'] },
      { eng: 'Be worried about sth/sb/doing sth', vn: 'lo l·∫Øng v·ªÅ c√°i g√¨/ai/l√†m g√¨ ƒë√≥', pronunciation: '/bi Ààw årid …ôÀàba ät Ààs åmŒ∏…™≈ã/Ààs åmb…ôdi/duÀê…™≈ã Ààs åmŒ∏…™≈ã/', level: 'B1', examples: ['She is worried about her exam results.'] },
      { eng: 'Be worth doing sth', vn: 'ƒë√°ng l√†m g√¨ ƒë√≥', pronunciation: '/bi w…úÀêŒ∏ duÀê…™≈ã Ààs åmŒ∏…™≈ã/', level: 'B1', examples: ['This book is worth reading.'] },
      { eng: 'Be worth it', vn: 'ƒë√°ng gi√°, x·ª©ng ƒë√°ng', pronunciation: '/bi w…úÀêŒ∏ …™t/', level: 'B1', examples: ['The effort was worth it.'] },
      { eng: 'Be worth something to sb', vn: 'c√≥ gi√° tr·ªã v·ªõi ai ƒë√≥', pronunciation: '/bi w…úÀêŒ∏ Ààs åmŒ∏…™≈ã t…ô Ààs åmb…ôdi/', level: 'B1', examples: ['This painting is worth a lot to me.'] },
      { eng: 'Be worth the money', vn: 'ƒë√°ng gi√° ti·ªÅn b·ªè ra', pronunciation: '/bi w…úÀêŒ∏ √∞…ô Ààm åni/', level: 'B1', examples: ['This product is worth the money.'] },
      { eng: 'Be worth the price', vn: 'ƒë√°ng gi√° v·ªõi gi√° ti·ªÅn', pronunciation: '/bi w…úÀêŒ∏ √∞…ô pra…™s/', level: 'B1', examples: ['This service is worth the price.'] },
      { eng: 'Be worth your while', vn: 'ƒë√°ng ƒë·ªÉ b·∫°n b·ªè th·ªùi gian, c√¥ng s·ª©c', pronunciation: '/bi w…úÀêŒ∏ j…îÀê wa…™l/', level: 'B1', examples: ['It will be worth your while to attend the seminar.'] },
      { eng: 'Be worth your time', vn: 'ƒë√°ng ƒë·ªÉ b·∫°n b·ªè th·ªùi gian', pronunciation: '/bi w…úÀêŒ∏ j…îÀê ta…™m/', level: 'B1', examples: ['This movie is worth your time.'] },
      { eng: 'Be worth your effort', vn: 'ƒë√°ng ƒë·ªÉ b·∫°n b·ªè c√¥ng s·ª©c', pronunciation: '/bi w…úÀêŒ∏ j…îÀê Ààef…ôt/', level: 'B1', examples: ['The project is worth your effort.'] },
      { eng: 'Be worth your attention', vn: 'ƒë√°ng ƒë·ªÉ b·∫°n ch√∫ √Ω', pronunciation: '/bi w…úÀêŒ∏ j…îÀê …ôÀàten Én/', level: 'B1', examples: ['This issue is worth your attention.'] },
      { eng: 'Be worth your investment', vn: 'ƒë√°ng ƒë·ªÉ b·∫°n ƒë·∫ßu t∆∞', pronunciation: '/bi w…úÀêŒ∏ j…îÀê …™nÀàvestm…ônt/', level: 'B1', examples: ['This business opportunity is worth your investment.'] },
      { eng: 'Be worth your consideration', vn: 'ƒë√°ng ƒë·ªÉ b·∫°n c√¢n nh·∫Øc', pronunciation: '/bi w…úÀêŒ∏ j…îÀê k…ônÀås…™d…ôÀàre…™ Én/', level: 'B1', examples: ['This proposal is worth your consideration.'] },
      { eng: 'Be worth your support', vn: 'ƒë√°ng ƒë·ªÉ b·∫°n ·ªßng h·ªô', pronunciation: '/bi w…úÀêŒ∏ j…îÀê s…ôÀàp…îÀêt/', level: 'B1', examples: ['This cause is worth your support.'] },
      { eng: 'Be worth your time and effort', vn: 'ƒë√°ng ƒë·ªÉ b·∫°n b·ªè th·ªùi gian v√† c√¥ng s·ª©c', pronunciation: '/bi w…úÀêŒ∏ j…îÀê ta…™m …ônd Ààef…ôt/', level: 'B1', examples: ['This event is worth your time and effort.'] },
      { eng: 'Act', vn: 'h√†nh ƒë·ªông, h√†nh x·ª≠', pronunciation: '/√¶kt/ v', level: 'A2', examples: ['We must act quickly to solve the problem.'] },
      { eng: 'Active', vn: 'nƒÉng ƒë·ªông', pronunciation: '/Àà√¶k.t…™v/ adj', level: 'A2', examples: ['She is active in several community projects.'] },
      { eng: 'Inactive', vn: 'th·ª• ƒë·ªông', pronunciation: '/…™nÀà√¶k.t…™v/ adj', level: 'B1', examples: ['He has been inactive since his injury.'] },
      { eng: 'Action', vn: 'h√†nh ƒë·ªông', pronunciation: '/Àà√¶k. É…ôn/ n', level: 'A2', examples: ['The government must take action to reduce pollution.'] },
      { eng: 'Actor', vn: 'di·ªÖn vi√™n', pronunciation: '/Àà√¶k.t…ôr/ n', level: 'A1', examples: ['He is a famous actor.'] },
      { eng: 'Athlete', vn: 'v·∫≠n ƒë·ªông vi√™n', pronunciation: '/Àà√¶Œ∏.liÀêt/ n', level: 'A2', examples: ['The athlete won three gold medals.'] },
      { eng: 'Athletic', vn: 'kh·ªèe m·∫°nh, ƒëi·ªÅn kinh', pronunciation: '/√¶Œ∏Ààlet.…™k/ adj', level: 'B1', examples: ['She has an athletic build.'] },
      { eng: 'Athletics', vn: 'm√¥n ƒëi·ªÅn kinh', pronunciation: '/√¶Œ∏Ààlet.…™ks/ n', level: 'B1', examples: ['He is training for a career in athletics.'] },
      { eng: 'Child', vn: 'ƒë·ª©a tr·∫ª', pronunciation: '/t Éa…™ld/ n', level: 'A1', examples: ['The child is playing in the garden.'] },
      { eng: 'Children', vn: 'tr·∫ª em', pronunciation: '/Ààt É…™l.dr…ôn/ n', level: 'A1', examples: ['Children love playing games.'] },
      { eng: 'Childhood', vn: 'th·ªùi th∆° ·∫•u', pronunciation: '/Ààt Éa…™ld.h äd/ n', level: 'B1', examples: ['He spent his childhood in the countryside.'] },
      { eng: 'Collect', vn: 'thu th·∫≠p, s∆∞u t·∫ßm', pronunciation: '/k…ôÀàlekt/ v', level: 'A2', examples: ['She collects stamps from all over the world.'] },
      { eng: 'Collection', vn: 'b·ªô s∆∞u t·∫≠p, s·ª± s∆∞u t·∫≠p', pronunciation: '/k…ôÀàlek. É…ôn/ n', level: 'A2', examples: ['He has a large collection of books.'] },
      { eng: 'Collector', vn: 'ng∆∞·ªùi s∆∞u t·∫≠p', pronunciation: '/k…ôÀàlek.t…ôr/ n', level: 'B1', examples: ['She is a collector of rare coins.'] },
      { eng: 'Entertain', vn: 'gi·∫£i tr√≠', pronunciation: '/en.t…ôÀàte…™n/ v', level: 'A2', examples: ['The clown entertained the children.'] },
      { eng: 'Entertainment', vn: 's·ª± gi·∫£i tr√≠', pronunciation: '/en.t…ôÀàte…™n.m…ônt/ n', level: 'A2', examples: ['The town offers a wide range of entertainment.'] },
      { eng: 'Hero', vn: 'anh h√πng', pronunciation: '/Ààh…™…ô.r…ô ä/ n', level: 'A2', examples: ['The firefighter is a national hero.'] },
      { eng: 'Heroic', vn: 'kh√≠ ph√°ch, anh d≈©ng', pronunciation: '/h…™Ààr…ô ä.…™k/ adj', level: 'B1', examples: ['She made a heroic effort to save the child.'] },
      { eng: 'Heroine', vn: 'n·ªØ anh h√πng', pronunciation: '/Ààher.…ô ä.…™n/ n', level: 'B1', examples: ['She is the heroine of the story.'] },
      { eng: 'Music', vn: '√¢m nh·∫°c', pronunciation: '/ÀàmjuÀê.z…™k/ n', level: 'A1', examples: ['I love listening to music.'] },
      { eng: 'Musical', vn: '√¢m nh·∫°c, nh·∫°c k·ªãch', pronunciation: '/ÀàmjuÀê.z…™.k…ôl/ adj, n', level: 'A2', examples: ['She has a musical talent.'] },
      { eng: 'Musician', vn: 'nh·∫°c sƒ©', pronunciation: '/mjuÀêÀàz…™ É.…ôn/ n', level: 'A2', examples: ['He is a talented musician.'] },
      { eng: 'Play', vn: 'ch∆°i, v·ªü k·ªãch', pronunciation: '/ple…™/ v, n', level: 'A1', examples: ['The children play in the park.'] },
      { eng: 'Player', vn: 'ng∆∞·ªùi ch∆°i, v·∫≠n ƒë·ªông vi√™n', pronunciation: '/Ààple…™.…ôr/ n', level: 'A1', examples: ['He is a football player.'] },
      { eng: 'Sport', vn: 'th·ªÉ thao, m√¥n th·ªÉ thao', pronunciation: '/sp…îÀêt/ n, v', level: 'A1', examples: ['Football is my favorite sport.'] },
      { eng: 'Sports', vn: 'th·ªÉ thao, m√¥n th·ªÉ thao', pronunciation: '/sp…îÀêts/ n', level: 'A1', examples: ['She enjoys playing sports.'] },
      { eng: 'Sportsman', vn: 'v·∫≠n ƒë·ªông vi√™n th·ªÉ thao', pronunciation: '/Ààsp…îÀêts.m…ôn/ n', level: 'B1', examples: ['He is a famous sportsman.'] },
      { eng: 'Sportswoman', vn: 'v·∫≠n ƒë·ªông vi√™n n·ªØ th·ªÉ thao', pronunciation: '/Ààsp…îÀêts.w äm…ôn/ n', level: 'B1', examples: ['She is a talented sportswoman.'] },
      { eng: 'Theatre', vn: 'nh√† h√°t, r·∫°p h√°t', pronunciation: '/ÀàŒ∏…™…ô.t…ôr/ | n', level: 'A2', examples: ['We went to the theatre to see a play.'] },
      { eng: 'Theatrical', vn: 'thu·ªôc v·ªÅ s√¢n kh·∫•u, k·ªãch ngh·ªá', pronunciation: '/Œ∏iÀà√¶t.r…™.k…ôl/ | adj', level: 'B1', examples: ['He has a theatrical style of acting.'] },
      { eng: 'Theatregoer', vn: 'ng∆∞·ªùi ƒëi xem k·ªãch, nh√† h√°t', pronunciation: '/ÀàŒ∏…™…ô.t…ôr.…°o ä…ôr/ | n', level: 'B1', examples: ['She is a regular theatregoer.'] },
      { eng: 'Win', vn: 'chi·∫øn th·∫Øng, gi√†nh chi·∫øn th·∫Øng', pronunciation: '/w…™n/ | v, n', level: 'A1', examples: ['They won the match.'] },
      { eng: 'Winner', vn: 'ng∆∞·ªùi chi·∫øn th·∫Øng', pronunciation: '/Ààw…™n…ôr/ | n', level: 'A1', examples: ['She is the winner of the competition.'] },
      { eng: 'Winning', vn: 'chi·∫øn th·∫Øng, th·∫Øng cu·ªôc', pronunciation: '/Ààw…™n.…™≈ã/ | adj, n', level: 'B1', examples: ['He has a winning smile.'] },
      { eng: 'Lose', vn: 'thua, m·∫•t', pronunciation: '/luÀêz/ | v', level: 'A1', examples: ['They lost the game.'] },
      { eng: 'Loser', vn: 'ng∆∞·ªùi thua cu·ªôc', pronunciation: '/ÀàluÀê.z…ôr/ n', level: 'A1', examples: ['He is a sore loser.'] },
      { eng: 'Losing', vn: 'thua cu·ªôc, th·∫•t b·∫°i', pronunciation: '/ÀàluÀê.z…™≈ã/ adj, n', level: 'B1', examples: ['The losing team was disappointed.'] },
      { eng: 'Win-win', vn: 'c√≥ l·ª£i cho c·∫£ hai b√™n', pronunciation: '/Ààw…™n.w…™n/ adj', level: 'B1', examples: ['It‚Äôs a win-win situation for both parties.'] },
      { eng: 'Draw', vn: 'h√≤a, tr·∫≠n h√≤a', pronunciation: '/dr…îÀê/ v, n', level: 'A2', examples: ['The match ended in a draw.'] },
      { eng: 'Drawn', vn: 'b·ªã k√©o, b·ªã l√¥i k√©o', pronunciation: '/dr…îÀên/ adj, v', level: 'B1', examples: ['She was drawn to the mysterious stranger.'] },
      { eng: 'Draws', vn: 'tr·∫≠n h√≤a, s·ª± thu h√∫t', pronunciation: '/dr…îÀêz/ n, v', level: 'B1', examples: ['The draws of the lottery are held every week.'] },
      { eng: 'Musical', vn: 'thu·ªôc v·ªÅ √¢m nh·∫°c', pronunciation: '/ÀàmjuÀê.z…™.k…ôl/ adj', level: 'A2', examples: ['She has a musical talent.'] },
      { eng: 'Musician', vn: 'nh·∫°c sƒ©', pronunciation: '/mjuÀêÀàz…™ É.…ôn/ n', level: 'A2', examples: ['He is a professional musician.'] },
      { eng: 'Playful', vn: 'tinh ngh·ªãch, nhi·ªÅu tr√≤', pronunciation: '/Ààple…™.f…ôl/ adj', level: 'B1', examples: ['The puppy is very playful.'] },
      { eng: 'Sail', vn: 'ƒëi thuy·ªÅn', pronunciation: '/se…™l/ v', level: 'A2', examples: ['We sailed across the lake.'] },
      { eng: 'Sailing', vn: 'm√¥n ƒëua thuy·ªÅn', pronunciation: '/Ààse…™.l…™≈ã/ n', level: 'B1', examples: ['Sailing is my favorite sport.'] },
      { eng: 'Sailor', vn: 'th·ªßy th·ªß', pronunciation: '/Ààse…™.l…ôr/ n', level: 'A2', examples: ['The sailor worked on the ship for many years.'] },
      { eng: 'Sing', vn: 'h√°t', pronunciation: '/s…™≈ã/ v', level: 'A1', examples: ['I like to sing in the shower.'] },
      { eng: 'Song', vn: 'b√†i h√°t', pronunciation: '/s…í≈ã/ n', level: 'A1', examples: ['That song is very popular.'] },
      { eng: 'Singer', vn: 'ca sƒ©', pronunciation: '/Ààs…™≈ã.…ôr/ n', level: 'A1', examples: ['She is a famous singer.'] },
      { eng: 'Singing', vn: 'ca h√°t', pronunciation: '/Ààs…™≈ã.…™≈ã/ n', level: 'A2', examples: ['Her singing is amazing.'] },
      { eng: 'Sang', vn: 'V2 c·ªßa sing', pronunciation: '/s√¶≈ã/ v', level: 'A2', examples: ['She sang beautifully at the concert.'] },
      { eng: 'Sung', vn: 'V3 c·ªßa sing', pronunciation: '/s å≈ã/ v', level: 'A2', examples: ['He has sung in many countries.'] }, 
      { eng: 'Sporty', vn: 'th√≠ch th·ªÉ thao, kh·ªèe m·∫°nh', pronunciation: '/Ààsp…îÀêr.ti/ adj', level: 'B1', examples: ['He has a sporty look.'] },
      { eng: 'Sportsmanship', vn: 'tinh th·∫ßn th·ªÉ thao', pronunciation: '/Ààsp…îÀêrts.m…ôn. É…™p/ n', level: 'B1', examples: ['Good sportsmanship is important in competitions.'] },
      { eng: 'Stage', vn: 's√¢n kh·∫•u, giai ƒëo·∫°n', pronunciation: '/ste…™d í/ n, v', level: 'A2', examples: ['The play will be performed on stage.'] },
      { eng: 'Staged', vn: 'ƒë∆∞·ª£c d√†n d·ª±ng, ƒë∆∞·ª£c t·ªï ch·ª©c', pronunciation: '/ste…™d íd/ adj, v', level: 'B1', examples: ['The event was staged to raise funds.'] },
      { eng: 'Staging', vn: 's·ª± d√†n d·ª±ng, t·ªï ch·ª©c', pronunciation: '/Ààste…™.d í…™≈ã/ n, v', level: 'B1', examples: ['The staging of the play was impressive.'] }, 
];
    function renderDictionary() { 
      const list = document.getElementById('wordList');
      const search = document.getElementById('searchInput');
      let currentWords = [...vocabulary];
      function displayWords(words) {
        list.innerHTML = '';
        words.forEach(({ eng, vn, pronunciation, level, examples }) => {
          const li = document.createElement('li');
          li.className = 'word-item';
          li.textContent = eng;
          li.addEventListener('click', () => {
            showDefinition(eng, vn, pronunciation, level, examples);
          });
          list.appendChild(li);
        });
      }
      search.addEventListener('input', () => {
        const key = search.value.trim().toLowerCase();
        currentWords = key === '' ? [...vocabulary] : vocabulary.filter(v => v.eng.toLowerCase().includes(key));
        displayWords(currentWords);
      });
      displayWords(currentWords);
    }
    function showDefinition(eng, vn, pronunciation, level, examples) {
      document.getElementById('wordMeaning').innerHTML = `<strong>${eng}</strong>: ${vn}`;
      document.getElementById('wordPronunciation').innerHTML = `Pronunciation: ${pronunciation}<br>
        <button onclick="speakWord('${eng}', 'en-US')">üîä US</button>
        <button onclick="speakWord('${eng}', 'en-GB')">üîä UK</button>`;
      document.getElementById('wordLevel').innerHTML = `Level: ${level}`;
      document.getElementById('wordExamples').innerHTML = `<strong>V√≠ d·ª•:</strong> ${examples.join(', ')}`;
      document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
      document.getElementById('definitionPage').classList.add('active');

      window.currentWordForSynonyms = eng;
      document.getElementById('synonyms-content').innerHTML = 'Ch·ªçn tab ƒê·ªìng nghƒ©a ƒë·ªÉ xem!';
    }

// Khi ch·ªçn t·ª´ trong danh s√°ch
function showWordDetails(wordObj) {
  selectedWord = wordObj.eng.trim(); // L∆∞u ƒë√∫ng ph·∫ßn ti·∫øng Anh
  document.getElementById('wordMeaning').innerText = wordObj.eng;
  document.getElementById('wordPronunciation').innerText = 'Pronunciation: ' + wordObj.pronunciation;
  document.getElementById('wordLevel').innerText = 'Level: ' + wordObj.level;
  document.getElementById('wordExamples').innerHTML = '<strong>Examples:</strong><br>' + wordObj.examples.join('<br>');
  showSection('definitionPage');
}

// AI l·∫•y t·ª´ ƒê·ªíNG NGHƒ®A v√† TR√ÅI NGHƒ®A
document.querySelector('.tab-item[data-tab="en"]').addEventListener('click', function() {
  const word = window.currentWordForSynonyms;
  const synDiv = document.getElementById('synonyms-content');
  if (!word) {
    synDiv.innerHTML = 'Ch∆∞a ch·ªçn t·ª´!';
    return;
  }
  synDiv.innerHTML = '';
  // L·∫•y ƒë·ªìng nghƒ©a
  fetch(`https://api.datamuse.com/words?rel_syn=${encodeURIComponent(word)}`)
    .then(res => res.json())
    .then(synData => {
      let html = '';
      if (synData && synData.length > 0) {
        const synonyms = synData.map(w => w.word).join(', ');
        html += `<b>ƒê·ªìng nghƒ©a:</b> ${synonyms}<br>`;
      }
      // L·∫•y tr√°i nghƒ©a
      fetch(`https://api.datamuse.com/words?rel_ant=${encodeURIComponent(word)}`)
        .then(res2 => res2.json())
        .then(antData => {
          if (antData && antData.length > 0) {
            const antonyms = antData.map(w => w.word).join(', ');
            html += `<b>Tr√°i nghƒ©a:</b> ${antonyms}`;
          }
          if (!html) html = 'Kh√¥ng t√¨m th·∫•y ƒë·ªìng nghƒ©a ho·∫∑c tr√°i nghƒ©a.';
          synDiv.innerHTML = html;
        })
        .catch(() => {
          if (!html) html = 'Kh√¥ng t√¨m th·∫•y ƒë·ªìng nghƒ©a ho·∫∑c tr√°i nghƒ©a.';
          synDiv.innerHTML = html;
        });
    })
    .catch(() => {
      synDiv.innerHTML = 'Kh√¥ng t√¨m th·∫•y ƒë·ªìng nghƒ©a ho·∫∑c tr√°i nghƒ©a.';
    });
});

// GI·∫¢I NGHƒ®A 
document.querySelector('.tab-item[data-tab="field"]').addEventListener('click', function() {
  const word = window.currentWordForSynonyms;
  const fieldDiv = document.getElementById('tab-field');
  const contentDiv = document.getElementById('specialized-content') || (() => {
    const div = document.createElement('div');
    div.id = 'specialized-content';
    fieldDiv.appendChild(div);
    return div;
  })();
  if (!word) {
    contentDiv.innerHTML = 'Ch∆∞a ch·ªçn t·ª´!';
    return;
  }
  contentDiv.innerHTML = 'ƒêang l·∫•y d·ªØ li·ªáu...';
  fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`)
    .then(res => res.json())
    .then(data => {
      let html = '';
      if (Array.isArray(data) && data[0]?.meanings?.length) {
        // L·∫•y t·∫•t c·∫£ nghƒ©a ti·∫øng Anh
        let allDefs = [];
        data[0].meanings.forEach(m => {
          m.definitions.forEach(d => {
            allDefs.push(d.definition);
          });
        });
        // D·ªãch to√†n b·ªô nghƒ©a sang ti·∫øng Vi·ªát
        fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=vi&dt=t&q=${encodeURIComponent(allDefs.join('\n'))}`)
          .then(res2 => res2.json())
          .then(transData => {
            // T√°ch nghƒ©a ƒë√£ d·ªãch
            const viDefs = transData[0].map(arr => arr[0]);
            let idx = 0;
            data[0].meanings.forEach(m => {
              html += `<b>${m.partOfSpeech || ''}</b><ul>`;
              m.definitions.forEach(d => {
                html += `<li>${viDefs[idx++]}</li>`;
              });
              html += `</ul>`;
            });
            contentDiv.innerHTML = html;
          })
          .catch(() => {
            contentDiv.innerHTML = 'Kh√¥ng th·ªÉ d·ªãch nghƒ©a sang ti·∫øng Vi·ªát.';
          });
      } else {
        contentDiv.innerHTML = 'Kh√¥ng t√¨m th·∫•y nghƒ©a chuy√™n ng√†nh cho t·ª´ n√†y.';
      }
    })
    .catch(() => {
      contentDiv.innerHTML = 'Kh√¥ng t√¨m th·∫•y nghƒ©a chuy√™n ng√†nh cho t·ª´ n√†y.';
    });
});


// NG·ªÆ PH√ÅP 
// H√†m ki·ªÉm tra t·ª´ h·ª£p l·ªá b·∫±ng API Free Dictionary
const IRREGULARS = {
  be: { v2: 'was', v2_alt: 'were', v3: 'been', ing: 'being', third: 'is' },
  have: { v2: 'had', v3: 'had', ing: 'having', third: 'has' },
  do: { v2: 'did', v3: 'done', ing: 'doing', third: 'does' },
  go: { v2: 'went', v3: 'gone', ing: 'going', third: 'goes' },
  get: { v2: 'got', v3: 'got', ing: 'getting', third: 'gets' },
  make: { v2: 'made', v3: 'made', ing: 'making', third: 'makes' },
  take: { v2: 'took', v3: 'taken', ing: 'taking', third: 'takes' },
  come: { v2: 'came', v3: 'come', ing: 'coming', third: 'comes' },
  see: { v2: 'saw', v3: 'seen', ing: 'seeing', third: 'sees' },
  eat: { v2: 'ate', v3: 'eaten', ing: 'eating', third: 'eats' },
  sing: { v2: 'sang', v3: 'sung', ing: 'singing', third: 'sings' },
  write: { v2: 'wrote', v3: 'written', ing: 'writing', third: 'writes' },
  run: { v2: 'ran', v3: 'run', ing: 'running', third: 'runs' },
  read: { v2: 'read', v3: 'read', ing: 'reading', third: 'reads' },
  buy: { v2: 'bought', v3: 'bought', ing: 'buying', third: 'buys' },
  bring: { v2: 'brought', v3: 'brought', ing: 'bringing', third: 'brings' },
  think: { v2: 'thought', v3: 'thought', ing: 'thinking', third: 'thinks' },
  say: { v2: 'said', v3: 'said', ing: 'saying', third: 'says' },
  speak: { v2: 'spoke', v3: 'spoken', ing: 'speaking', third: 'speaks' },
  begin: { v2: 'began', v3: 'begun', ing: 'beginning', third: 'begins' },
  sleep: { v2: 'slept', v3: 'slept', ing: 'sleeping', third: 'sleeps' }
};

function isVowel(ch) {
  return 'aeiou'.includes(ch);
}

function endsWithCVC(word) {
  if (!word || word.length < 3) return false;
  const w = word.toLowerCase();
  const a = w[w.length - 3];
  const b = w[w.length - 2];
  const c = w[w.length - 1];
  // Kh√¥ng double nh·ªØng ch·ªØ c√°i w, x, y
  if (['w','x','y'].includes(c)) return false;
  return !isVowel(a) && isVowel(b) && !isVowel(c);
}

function capitalize(word) {
  if (!word) return '';
  return word[0].toUpperCase() + word.slice(1);
}

function normalize(word) {
  if (!word) return '';
  // L·∫•y ch·ªØ tr∆∞·ªõc d·∫•u ':' (n·∫øu c√≥), b·ªè d·∫•u ngo√†i ch·ªØ v√† kho·∫£ng tr·∫Øng
  let w = String(word).trim();
  if (w.includes(':')) w = w.split(':')[0].trim();
  // N·∫øu l√† c·ª•m t·ª´ (Good morning) gi·ªØ nguy√™n (c√≤n n·∫øu b·∫°n mu·ªën ch·ªâ l·∫•y 1 t·ª´, thay logic ·ªü ƒë√¢y)
  return w.replace(/["'`\n\r]/g, '').trim();
}

function conjugateVerb(base) {
  const raw = (base || '').toString().trim();
  const b = raw.toLowerCase();
  if (!b) return { base: raw, third: '', v2: '', v3: '', gerund: '' };

  // irregular
  if (IRREGULARS[b]) {
    const r = IRREGULARS[b];
    return {
      base: b,
      third: r.third || (b + 's'),
      v2: r.v2 || (b + 'ed'),
      v3: r.v3 || (b + 'ed'),
      gerund: r.ing || (b + 'ing')
    };
  }

  // gerund (V-ing)
  let gerund;
  if (b.endsWith('ie')) {
    gerund = b.replace(/ie$/, 'ying'); // lie -> lying
  } else if (b.endsWith('e') && !b.endsWith('ee')) {
    gerund = b.replace(/e$/, 'ing'); // make -> making
  } else if (endsWithCVC(b)) {
    gerund = b + b[b.length - 1] + 'ing'; // run -> running
  } else {
    gerund = b + 'ing';
  }

  // past (V2) and past participle (V3)
  let v2, v3;
  if (b.endsWith('e')) {
    v2 = b + 'd';
  } else if (b.endsWith('y') && !isVowel(b[b.length - 2])) {
    v2 = b.slice(0, -1) + 'ied';
  } else if (endsWithCVC(b)) {
    v2 = b + b[b.length - 1] + 'ed';
  } else {
    v2 = b + 'ed';
  }
  v3 = v2; // For regular verbs

  // third person singular
  let third;
  if (/(s|x|z|ch|sh|o)$/.test(b)) third = b + 'es';
  else if (b.endsWith('y') && !isVowel(b[b.length - 2])) third = b.slice(0, -1) + 'ies';
  else third = b + 's';

  return { base: b, third, v2, v3, gerund };
}

async function generateFamilyWords(baseWord) {
  const base = normalize(baseWord).toLowerCase();
  if (!base) return { noun: '', verb: '', adjective: '', adverb: '' };

  // candidates (theo quy t·∫Øc ƒë∆°n gi·∫£n) - s·∫Ω ki·ªÉm tra b·∫±ng isValidWord n·∫øu c√≥
  const candidates = {
    noun: [base, base + 'er', base.replace(/e$/, '') + 'er', base + 'ion', base + 'ment', base + 'ing'],
    verb: [base],
    adjective: [base + 'y', base + 'ful', base + 'ive', base + 'al'],
    adverb: [base + 'ly']
  };

  const result = { noun: '', verb: '', adjective: '', adverb: '' };
  const canCheck = (typeof isValidWord === 'function');

  for (const kind of Object.keys(candidates)) {
    const list = candidates[kind];
    let chosen = '';
    if (canCheck) {
      for (let cand of list) {
        try {
          // isValidWord c√≥ th·ªÉ g·ªçi API dictionary; n·∫øu true -> ch·ªçn
          // th√™m timeout/bail-out n·∫øu c·∫ßn
          /* eslint-disable no-await-in-loop */
          // ƒë·∫£m b·∫£o lo·∫°i b·ªè kho·∫£ng tr·∫Øng v√† k√Ω t·ª± l·∫°
          cand = cand.trim();
          if (!cand) continue;
          // m·ªôt s·ªë API kh√¥ng ch·∫•p nh·∫≠n multi-word; b·ªè qua
          if (cand.includes(' ')) continue;
          // Ki·ªÉm tra
          // isValidWord c√≥ th·ªÉ n√©m l·ªói n·∫øu API tr·ª•c tr·∫∑c
          // Do isValidWord ƒë√£ c√≥ trong file g·ªëc, t·∫≠n d·ª•ng n√≥
          // Nh∆∞ng n·∫øu vi·ªác g·ªçi API th·∫•t b·∫°i (m·∫°ng), fallback s·∫Ω √°p d·ª•ng
          // await isValidWord may be slow; but acceptable here.
          // N·∫øu isValidWord kh√¥ng t·ªìn t·∫°i, b·∫≠t fallback ƒë·ªÉ hi·ªÉn th·ªã d·∫°ng suy ƒëo√°n.
          // N·∫øu isValidWord tr·∫£ true => ch·ªçn v√† break
          // N·∫øu isValidWord tr·∫£ false => ti·∫øp
          // N·∫øu isValidWord n√©m => catch v√† ti·∫øp
          // IMPORTANT: n·∫øu isValidWord qu√° ch·∫≠m ho·∫∑c h·∫°n ch·∫ø CORS, fallback s·∫Ω hi·ªÉn th·ªã ph√°n ƒëo√°n.
          // Th·ªùi gian ch·ªù kh√¥ng ƒë∆∞·ª£c √°p d·ª•ng ·ªü ƒë√¢y ƒë·ªÉ code ƒë∆°n gi·∫£n ‚Äî c√≥ th·ªÉ th√™m timeout n·∫øu c·∫ßn.
          if (await isValidWord(cand)) { chosen = cand; break; }
        } catch (e) {
          // ignore v√† d√πng fallback
        }
      }
    }
    if (!chosen) {
      // fallback: l·∫•y candidate ƒë·∫ßu ti√™n h·ª£p l√Ω
      chosen = list.find(Boolean) || '';
    }
    result[kind] = chosen;
  }
  return result;
}

async function generateTenseExamples(word) {
  const cleaned = normalize(word);
  const base = cleaned.split(' ')[0] || cleaned; // l·∫•y t·ª´ ƒë·∫ßu c·ªßa c·ª•m t·ª´ n·∫øu c√≥
  if (!base) return {
    presentSimple: '', pastSimple: '', futureSimple: '',
    presentContinuous: '', pastContinuous: '', futureContinuous: '',
    presentPerfect: '', pastPerfect: '', futurePerfect: ''
  };

  // N·∫øu isValidWord t·ªìn t·∫°i v√† tr·∫£ false th√¨ v·∫´n ti·∫øp (v√¨ nhi·ªÅu t·ª´-c·ª•m kh√¥ng c√≥ trong dict)
  const conj = conjugateVerb(base);

  // Build example sentences with correct forms
  const examples = {
    presentSimple: `I ${conj.base} every day.`,
    pastSimple: `I ${conj.v2} yesterday.`,
    futureSimple: `I will ${conj.base} tomorrow.`,
    presentContinuous: `I am ${conj.gerund} now.`,
    pastContinuous: `I was ${conj.gerund} yesterday.`,
    futureContinuous: `I will be ${conj.gerund} tomorrow.`,
    presentPerfect: `I have ${conj.v3} many times.`,
    pastPerfect: `I had ${conj.v3} before you arrived.`,
    futurePerfect: `I will have ${conj.v3} by next week.`
  };

  return examples;
}

async function showGrammarAndFamilyWords(selectedWord) {
  const cleaned = normalize(selectedWord);
  const wordForLookup = (window.currentWordForSynonyms || cleaned).toString().trim();
  if (!wordForLookup) {
    // clear fields
    ['familyNoun','familyVerb','familyAdjective','familyAdverb','presentSimple','pastSimple','futureSimple','presentContinuous','pastContinuous','futureContinuous','presentPerfect','pastPerfect','futurePerfect']
      .forEach(id => { const el = document.getElementById(id); if (el) el.innerText = ''; });
    return;
  }

  // Family words
  const family = await generateFamilyWords(wordForLookup);
  if (document.getElementById('familyNoun')) document.getElementById('familyNoun').innerText = family.noun || '-';
  if (document.getElementById('familyVerb')) document.getElementById('familyVerb').innerText = family.verb || (normalize(wordForLookup) || '-');
  if (document.getElementById('familyAdjective')) document.getElementById('familyAdjective').innerText = family.adjective || '-';
  if (document.getElementById('familyAdverb')) document.getElementById('familyAdverb').innerText = family.adverb || '-';

  // Tenses
  const tenses = await generateTenseExamples(wordForLookup);
  if (document.getElementById('presentSimple')) document.getElementById('presentSimple').innerText = tenses.presentSimple;
  if (document.getElementById('pastSimple')) document.getElementById('pastSimple').innerText = tenses.pastSimple;
  if (document.getElementById('futureSimple')) document.getElementById('futureSimple').innerText = tenses.futureSimple;
  if (document.getElementById('presentContinuous')) document.getElementById('presentContinuous').innerText = tenses.presentContinuous;
  if (document.getElementById('pastContinuous')) document.getElementById('pastContinuous').innerText = tenses.pastContinuous;
  if (document.getElementById('futureContinuous')) document.getElementById('futureContinuous').innerText = tenses.futureContinuous;
  if (document.getElementById('presentPerfect')) document.getElementById('presentPerfect').innerText = tenses.presentPerfect;
  if (document.getElementById('pastPerfect')) document.getElementById('pastPerfect').innerText = tenses.pastPerfect;
  if (document.getElementById('futurePerfect')) document.getElementById('futurePerfect').innerText = tenses.futurePerfect;
}

// Attach to grammar tab click (overwrite existing listener behavior safely)
(function attachGrammarTab() {
  const btn = document.querySelector('.tab-item[data-tab="grammar"]');
  if (!btn) return;
  btn.removeEventListener('click', btn._grammarClickHandler);
  const handler = async function () {
    const wordEl = document.getElementById('wordMeaning');
    let word = window.currentWordForSynonyms || (wordEl && wordEl.textContent) || '';
    word = normalize(word);
    if (!word) {
      alert('Ch∆∞a ch·ªçn t·ª´! Vui l√≤ng ch·ªçn m·ªôt t·ª´ trong danh s√°ch.');
      return;
    }
    await showGrammarAndFamilyWords(word);
  };
  // store ref so removeEventListener can work in future
  btn._grammarClickHandler = handler;
  btn.addEventListener('click', handler);
})();

    // Microphone functionality
    function showSection(id) {
      document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.sidebar button').forEach(btn => btn.classList.remove('active'));
      const btn = [...document.querySelectorAll('.sidebar button')].find(b => b.getAttribute('onclick')?.includes(id));
      if (btn) btn.classList.add('active');
    }
      const micBtn = document.getElementById('micBtn');
      const searchInput = document.getElementById('searchInput');
      micBtn.addEventListener('click', () => {
        if (!('webkitSpeechRecognition' in window)) {
          alert('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ gi·ªçng n√≥i.');
          return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      recognition.start();
      micBtn.textContent = 'üéôÔ∏è';
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        searchInput.value = transcript;
        searchInput.dispatchEvent(new Event('input'));
        micBtn.textContent = 'üé§';
      };
      recognition.onerror = () => {
        micBtn.textContent = 'üé§';
        alert('Kh√¥ng th·ªÉ nh·∫≠n d·∫°ng gi·ªçng n√≥i.');
      };
      recognition.onend = () => {
        micBtn.textContent = 'üé§';
      };
    });

    //
    document.querySelectorAll('.tab-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.tab-item').forEach(btn => btn.classList.remove('active'));
    item.classList.add('active');
  });
});
document.querySelectorAll('.tab-item').forEach(item => {
  item.addEventListener('click', () => {
    // Chuy·ªÉn active tab
    document.querySelectorAll('.tab-item').forEach(btn => btn.classList.remove('active'));
    item.classList.add('active');
    // ·∫®n t·∫•t c·∫£ tab content
    document.querySelectorAll('#definitionPage .tab-content').forEach(div => div.style.display = 'none');
    // Hi·ªán tab ƒë√£ ch·ªçn
    const tabId = item.dataset.tab;
    document.getElementById('tab-' + tabId).style.display = 'block';
  });
});

/*Ph·∫ßn B√†i T·∫≠p Th√¨*/
async function generateExercise(tense) {
  const manualQuestions = {
    "Present Simple": [
      { question: "She ____ to school every day.", options: ["go", "goes", "going", "gone"], answer: "goes" },
      { question: "I ____ coffee in the morning.", options: ["drink", "drinks", "drank", "drinking"], answer: "drink" },
      { question: "We ____ in London.", options: ["live", "lives", "living", "lived"], answer: "live" },
      { question: "He usually ____ breakfast at 7 a.m.", options: ["have", "has", "having", "had"], answer: "has" },
      { question: "My brother rarely ____ breakfast before 7 a.m.", options: ["have", "has", "having", "had"], answer: "has" },
      { question: "The museum ____ at 9 a.m. every day except Monday.", options: ["open", "opens", "opening", "opened"], answer: "opens" },
      { question: "I never ____ sugar in my coffee.", options: ["put", "puts", "putting", "putted"], answer: "put" },
      { question: "Where ____ your grandparents live?", options: ["do", "does", "are", "did"], answer: "do" },
      { question: "The train to Paris ____ from platform 3 at 10:15 a.m.", options: ["leave", "leaves", "leaving", "left"], answer: "leaves" },
      { question: "She doesn‚Äôt usually ____ lunch at home on weekdays.", options: ["have", "has", "having", "had"], answer: "have" },
      { question: "How often ____ he call his parents?", options: ["do", "does", "is", "did"], answer: "does" },
      { question: "My parents always ____ their bills on time.", options: ["pay", "pays", "paying", "paid"], answer: "pay" },
      { question: "If it rains tomorrow, the match ____ postponed.", options: ["is", "be", "will be", "was"], answer: "is" },
      { question: "The Earth ____ around the Sun once a year.", options: ["go", "goes", "going", "gone"], answer: "goes" },
      { question: "What time ____ your father usually get home from work?", options: ["do", "does", "is", "did"], answer: "does" },
      { question: "He ____ TV unless there‚Äôs a football match.", options: ["doesn't watch", "don't watch", "watches", "watched"], answer: "doesn't watch" },
      { question: "The shop assistant always ____ customers politely.", options: ["greet", "greets", "greeting", "greeted"], answer: "greets" },
      { question: "Why ____ you always arrive late for class?", options: ["do", "does", "are", "did"], answer: "do" },
      { question: "My best friend and I ____ each other very well.", options: ["understands", "understand", "understanding", "understood"], answer: "understand" },
      { question: "The library closes at 5 p.m., but on Fridays it ____ at 4 p.m.", options: ["close", "closes", "closing", "closed"], answer: "closes" }
    ],
    "Past Simple": [
      { question: "They ____ football yesterday.", options: ["play", "plays", "played", "playing"], answer: "played" },
      { question: "He ____ to the market last week.", options: ["go", "goes", "went", "gone"], answer: "went" },
      { question: "I ____ a movie last night.", options: ["watch", "watches", "watched", "watching"], answer: "watched" },
      { question: "We ____ to Paris in 2019.", options: ["travel", "travels", "traveled", "traveling"], answer: "traveled" },
      { question: "My brother ____ the guitar when he was a teenager.", options: ["play", "played", "plays", "playing"], answer: "played" },
      { question: "We ____ any homework last night because the teacher was absent.", options: ["don‚Äôt have", "didn‚Äôt have", "doesn‚Äôt have", "hadn‚Äôt"], answer: "didn‚Äôt have" },
      { question: "Where ____ you go on holiday last summer?", options: ["do", "does", "did", "done"], answer: "did" },
      { question: "I ____ my wallet on the bus yesterday morning.", options: ["lose", "loses", "lost", "losing"], answer: "lost" },
      { question: "They ____ in Paris for two years before moving to Rome.", options: ["live", "lives", "lived", "living"], answer: "lived" },
      { question: "She ____ to the cinema but didn‚Äôt enjoy the film.", options: ["go", "went", "goes", "gone"], answer: "went" },
      { question: "What time ____ the concert start last night?", options: ["do", "does", "did", "done"], answer: "did" },
      { question: "I ____ my best friend at a caf√© three days ago.", options: ["meet", "meets", "met", "meeting"], answer: "met" },
      { question: "They ____ a lot of money on their wedding party.", options: ["spend", "spends", "spent", "spending"], answer: "spent" },
      { question: "We didn‚Äôt ____ the answer to question 5.", options: ["know", "knew", "knows", "knowing"], answer: "know" },
      { question: "Who ____ the door when you arrived?", options: ["open", "opened", "opens", "opening"], answer: "opened" },
      { question: "He ____ breakfast and then left for work.", options: ["has", "had", "have", "having"], answer: "had" },
      { question: "My parents ____ me a bike for my 12th birthday.", options: ["buy", "bought", "buys", "buyed"], answer: "bought" },
      { question: "We ____ in the library for two hours yesterday afternoon.", options: ["study", "studies", "studied", "studying"], answer: "studied" },
      { question: "Why ____ she cry after the meeting?", options: ["do", "does", "did", "done"], answer: "did" },
      { question: "The movie was boring, so we ____ before it finished.", options: ["leave", "leaves", "left", "leaving"], answer: "left" }
    ],
    "Future Simple": [
      { question: "I ____ to the party tomorrow night.", options: ["go", "going", "will go", "went"], answer: "will go" },
      { question: "She ____ her exams next week.", options: ["take", "takes", "will take", "took"], answer: "will take" },
      { question: "They ____ a new car next month.", options: ["buy", "buys", "will buy", "bought"], answer: "will buy" },
      { question: "We ____ to the beach this weekend.", options: ["go", "going", "will go", "went"], answer: "will go" },
      { question: "He ____ his homework later today.", options: ["do", "does", "will do", "did"], answer: "will do" },
      { question: "I think it ____ rain tomorrow.", options: ["isn't going to", "won't", "doesn't going to", "didn't"], answer: "won't" },
      { question: "Where ____ you travel next summer?", options: ["do", "does", "are going to", "did"], answer: "are going to" },
      { question: "They ____ their grandparents next week.", options: ["visit", "visits", "will visit", "visited"], answer: "will visit" },
      { question: "She ____ her birthday party next month.", options: ["have", "has", "will have", "had"], answer: "will have" },
      { question: "What time ____ the meeting start tomorrow?", options: ["do", "does", "is going to", "did"], answer: "is going to" },
      { question: "I promise I ____ help you with your project.", options: ["will", "won't", "", ""], answer: "will" },
      { question: "He said he ____ call me later.", options: ["wouldn't", "", "", ""], answer: "" },
      { question: "We ____ finish the report by Friday.", options: ["will", "won't", "", ""], answer: "will" },
      { question: "They ____ not attend the conference next month.", options: ["will", "won't", "", ""], answer: "won't" },
      { question: "I think she ____ be late for the meeting.", options: ["will", "won't", "", ""], answer: "will" },
      { question: "He promised he ____ help us with the project.", options: ["would", "wouldn't", "", ""], answer: "would" },
      { question: "We ____ go hiking if the weather is nice.", options: ["will", "won't", "", ""], answer: "will" },
      { question: "She said she ____ join us for dinner.", options: ["wouldn't", "", "", ""], answer: "" },
      { question: "I hope they ____ arrive on time.", options: ["will", "won't", "", ""], answer: "will" },
      { question: "What time ____ the train leave tomorrow?", options: ["does", "do", "is going to", "did"], answer: "is going to" }
    ],
    "Present Continuous": [
      { question: "I ____ my homework right now.", options: ["do", "does", "am doing", "did"], answer: "am doing" },
      { question: "She ____ a book at the moment.", options: ["read", "reads", "is reading", "reading"], answer: "is reading" },
      { question: "They ____ to the cinema tonight.", options: ["go", "going", "are going", "went"], answer: "are going" },
      { question: "We ____ dinner at 7 p.m. today.", options: ["have", "having", "are having", "had"], answer: "are having" },
      { question: "He ____ his car right now.", options: ["wash", "washes", "is washing", "washed"], answer: "is washing" },
      { question: "I ____ not working this weekend.", options: ["am not", "", "", ""], answer: "" },
      { question: "Where ____ you going after class?", options: ["are", "", "", ""], answer: "" },
      { question: "They ____ a new project at work this week.", options: ["start", "starts", "are starting", "started"], answer: "are starting" },
      { question: "She ____ her friends for coffee right now.", options: ["meet", "meets", "is meeting", "met"], answer: "is meeting" },
      { question: "What time ____ the concert start tonight?", options: ["does", "", "", ""], answer: "" },
      { question: "I think it ____ rain later today.", options: ["isn't going to", "", "", ""], answer: "" },
      { question: "He said he ____ call me later.", options: ["wouldn't", "", "", ""], answer: "" },
      { question: "We ____ finish the report by Friday.", options: ["will", "", "", ""], answer: "" },
      { question: "They ____ not attend the conference next month.", options: ["will", "", "", ""], answer: "" },
      { question: "I hope she ____ be late for the meeting.", options: ["won't", "", "", ""], answer: "" },
      { question: "He promised he ____ help us with the project.", options: ["wouldn't", "", "", ""], answer: "" },
      { question: "We ____ go hiking if the weather is nice.", options: ["will", "", "", ""], answer: "" },
      { question: "She said she ____ join us for dinner.", options: ["wouldn't", "", "", ""], answer: "" },
      { question: "I hope they ____ arrive on time.", options: ["will", "", "", ""], answer: "" },
      { question: "What time ____ the train leave tomorrow?", options: ["does", "", "", ""], answer: "" }
  ],
    "Past Continuous": [
      { question: "I ____ my homework when the phone rang.", options: ["do", "was doing", "did", "doing"], answer: "was doing" },
      { question: "She ____ a book when I arrived.", options: ["read", "was reading", "reads", "reading"], answer: "was reading" },
      { question: "They ____ to the cinema when it started to rain.", options: ["go", "were going", "went", "going"], answer: "were going" },
      { question: "We ____ dinner when the power went out.", options: ["have", "were having", "had", "having"], answer: "were having" },
      { question: "He ____ his car when I saw him.", options: ["wash", "was washing", "washes", "washed"], answer: "was washing" },
      { question: "I ____ not working at that time.", options: ["was not", "", "", ""], answer: "" },
      { question: "Where ____ you going when I called?", options: ["were", "", "", ""], answer: "" },
      { question: "They ____ a new project at work last week.", options: ["start", "were starting", "started", "starting"], answer: "were starting" },
      { question: "She ____ her friends for coffee when I saw her.", options: ["meet", "was meeting", "meets", "met"], answer: "was meeting" },
      { question: "What time ____ the concert start last night?", options: ["did", "", "", ""], answer: "" },
      { question: "I think it ____ rain later yesterday.", options: ["wasn't going to", "", "", ""], answer: "" },
      { question: "He said he ____ call me later yesterday.", options: ["wouldn't", "", "", ""], answer: "" },
      { question: "We ____ finish the report by Friday last week.", options: ["were going to", "", "", ""], answer: "" },
      { question: "They ____ not attend the conference next month.", options: ["will not be attending", "", "", ""], answer: "" },
      { question: "I hope she ____ be late for the meeting yesterday.", options: ["wasn't going to be late", "", "", ""], answer: "" },
      { question: "He promised he ____ help us with the project yesterday.", options: ["wouldn't", "", "", ""], answer: "" },
      { question: "We ____ go hiking if the weather was nice yesterday.", options: ["were going to", "", "", ""], answer: "" },
      { question: "She said she ____ join us for dinner yesterday.", options: ["wouldn't", "", "", ""], answer: "" },
      { question: "I hope they ____ arrive on time yesterday.", options: ["didn't", "", "", ""], answer: "" },
      { question: "What time ____ the train leave yesterday?", options: ["did", "", "", ""], answer: "" }
  ],
    "Present Perfect": [
      { question: "I ____ my homework already.", options: ["do", "did", "have done", "doing"], answer: "have done" },
      { question: "She ____ a book this week.", options: ["read", "reads", "has read", "reading"], answer: "has read" },
      { question: "They ____ to the cinema three times this month.", options: ["go", "went", "have gone", "going"], answer: "have gone" },
      { question: "We ____ dinner already.", options: ["have", "had", "has had", "having"], answer: "have had" },
      { question: "He ____ his car recently.", options: ["wash", "washes", "has washed", "washed"], answer: "has washed" },
      { question: "I ____ not working today.", options: ["am not", "", "", ""], answer: "" },
      { question: "Where ____ you going after class?", options: ["are", "", "", ""], answer: "" },
      { question: "They ____ a new project at work this week.", options: ["start", "started", "have started", "starting"], answer: "have started" },
      { question: "She ____ her friends for coffee today.", options: ["meet", "meets", "has met", "meeting"], answer: "has met" },
      { question: "What time ____ the concert start?", options: ["does", "", "", ""], answer: "" },
      { question: "I think it ____ rain later today.", options: ["isn't going to", "", "", ""], answer: "" },
      { question: "He said he ____ call me later today.", options: ["wouldn't", "", "", ""], answer: "" },
      { question: "We ____ finish the report by Friday.", options: ["will have finished", "", "", ""], answer: "" },
      { question: "They ____ not attend the conference next month.", options: ["will not be attending", "", "", ""], answer: "" },
      { question: "I hope she ____ be late for the meeting today.", options: ["won't be late", "", "", ""], answer: "" },
      { question: "He promised he ____ help us with the project today.", options: ["wouldn't help us today", "", "", ""], answer: "" },
      { question: "We ____ go hiking if the weather is nice today.", options: ["will go", "", "", ""], answer: "" },
      { question: "She said she ____ join us for dinner today.", options: ["wouldn't join us", "", "", ""], answer: "" },
      { question: "I hope they ____ arrive on time today.", options: ["will arrive", "", "", ""], answer: "" },
      { question: "What time ____ the train leave today?", options: ["does", "", "", ""], answer: "" }
  ],
    "Past Perfect": [
      { question: "I ____ my homework before dinner.", options: ["had done", "did", "have done", "doing"], answer: "had done" },
      { question: "She ____ a book before the meeting started.", options: ["had read", "reads", "has read", "reading"], answer: "had read" },
      { question: "They ____ to the cinema before it started to rain.", options: ["had gone", "went", "have gone", "going"], answer: "had gone" },
      { question: "We ____ dinner before the power went out.", options: ["had had", "have had", "had", "having"], answer: "had had" },
      { question: "He ____ his car before I saw him.", options: ["had washed", "washes", "has washed", "washed"], answer: "had washed" },
      { question: "I ____ not working when you called.", options: ["was not", "", "", ""], answer: "" },
      { question: "Where ____ you going when I called?", options: ["were", "", "", ""], answer: "" },
      { question: "They ____ a new project at work last week.", options: ["had started", "started", "have started", "starting"], answer: "had started" },
      { question: "She ____ her friends for coffee when I saw her.", options: ["had met", "meets", "has met", "meeting"], answer: "had met" },
      { question: "What time ____ the concert start last night?", options: ["did", "", "", ""], answer: "" },
      { question: "I think it ____ rain later yesterday.", options: ["wasn't going to", "", "", ""], answer: "" },
      { question: "He said he ____ call me later yesterday.", options: ["wouldn't have called me later yesterday", "", "", ""], answer: "" },
      { question: "We ____ finish the report by Friday last week.", options: ["were going to finish it by Friday last week", "", "", ""], answer: "" },
      { question: "They ____ not attend the conference next month.", options: ["will not be attending next month", "", "", ""], answer: "" },
      { question: "I hope she ____ be late for the meeting yesterday.", options: ["wasn't going to be late for the meeting yesterday", "", "", ""], answer: "" },
      { question: "He promised he ____ help us with the project yesterday.", options: ["wouldn't have helped us with the project yesterday", "", "", ""], answer: "" },
      { question: "We ____ go hiking if the weather was nice yesterday.", options: ["were going to go hiking if the weather was nice yesterday", "", "", ""], answer: "" },
      { question: "She said she ____ join us for dinner yesterday.", options: ["wouldn't have joined us for dinner yesterday", "", "", ""], answer: "" },
      { question: "I hope they ____ arrive on time yesterday.", options: ["didn't arrive on time yesterday", "", "", ""], answer: "" },
      { question: "What time ____ the train leave yesterday?", options: ["did", "", "", ""], answer: "" }
  ],
    "Future Perfect": [
      { question: "I ____ my homework by 8 p.m. tonight.", options: ["will have done", "did", "have done", "doing"], answer: "will have done" },
      { question: "She ____ a book by the end of this month.", options: ["will have read", "reads", "has read", "reading"], answer: "will have read" },
      { question: "They ____ to the cinema by next week.", options: ["will have gone", "went", "have gone", "going"], answer: "will have gone" },
      { question: "We ____ dinner by 7 p.m. tomorrow.", options: ["will have had", "have had", "had", "having"], answer: "will have had" },
      { question: "He ____ his car by the time I arrive.", options: ["will have washed", "washes", "has washed", "washed"], answer: "will have washed" },
      { question: "I ____ not working next weekend.", options: ["am not going to be working next weekend", "", "", ""], answer: "" },
      { question: "Where ____ you going after class tomorrow?", options: ["are going to be going after class tomorrow", "", "", ""], answer: "" },
      { question: "They ____ a new project at work by next month.", options: ["will have started a new project at work by next month", "", "", ""], answer: "" },
      { question: "She ____ her friends for coffee tomorrow afternoon.", options: ["is going to meet her friends for coffee tomorrow afternoon", "", "", ""], answer: "" },
      { question: "What time ____ the concert start tomorrow night?", options: ["is going to start tomorrow night", "", "", ""], answer: "" },
      { question: "I think it ____ rain later today.", options: ["isn't going to rain later today", "", "", ""], answer: "" },
      { question: "He said he ____ call me later today.", options: ["wouldn't call me later today", "", "", ""], answer: "" },
      { question: "We ____ finish the report by Friday this week.", options: ["will finish the report by Friday this week", "", "", ""], answer: "" },
      { question: "They ____ not attend the conference next month.", options: ["will not be attending the conference next month", "", "", ""], answer: "" },
      { question: "I hope she ____ be late for the meeting tomorrow.", options: ["won't be late for the meeting tomorrow", "", "", ""], answer: "" },
      { question: "He promised he ____ help us with the project tomorrow.", options: ["wouldn't help us with the project tomorrow", "", "", ""], answer: "" },
      { question: "We ____ go hiking if the weather is nice tomorrow.", options: ["will go hiking if the weather is nice tomorrow", "", "", ""], answer: "" },
      { question: "She said she ____ join us for dinner tomorrow night.", options: ["wouldn't join us for dinner tomorrow night", "", "", ""], answer: "" },
      { question: "I hope they ____ arrive on time tomorrow.", options: ["will arrive on time tomorrow", "", "", ""], answer: "" },
      { question: "What time ____ the train leave tomorrow?", options: ["does", "", "", ""], answer: "" }
  ],  
    "Future Continuous": [
      { question: "This time tomorrow, I ____ on the beach.", options: ["will be lying", "will lie", "am lying", "lie"], answer: "will be lying" },
      { question: "At 8 p.m. tonight, she ____ dinner with her family.", options: ["will be having", "has", "is having", "will have"], answer: "will be having" },
      { question: "We ____ to London this time next week.", options: ["will be flying", "fly", "will fly", "are flying"], answer: "will be flying" },
      { question: "They ____ for the exam all day tomorrow.", options: ["will be studying", "study", "will study", "are studying"], answer: "will be studying" },
      { question: "By the end of the month, I ____ in a new apartment.", options: ["will be living", "live", "will live", "am living"], answer: "will be living" },
      { question: "He ____ football with his friends this afternoon.", options: ["will be playing", "plays", "play", "will play"], answer: "will be playing" },
      { question: "At this time next year, we ____ around Europe.", options: ["will be traveling", "travel", "will travel", "are traveling"], answer: "will be traveling" },
      { question: "She ____ at the library later today.", options: ["will be working", "works", "work", "will work"], answer: "will be working" },
      { question: "I ____ my favorite TV show at 9 p.m. tonight.", options: ["will be watching", "watch", "am watching", "will watch"], answer: "will be watching" },
      { question: "At 3 p.m. tomorrow, they ____ in a meeting.", options: ["will be sitting", "sit", "will sit", "are sitting"], answer: "will be sitting" },
      { question: "You ____ when I arrive tomorrow morning.", options: ["will be sleeping", "sleep", "will sleep", "are sleeping"], answer: "will be sleeping" },
      { question: "We ____ to music during the party.", options: ["will be dancing", "dance", "will dance", "are dancing"], answer: "will be dancing" },
      { question: "At this time tomorrow, the children ____ in the park.", options: ["will be playing", "play", "will play", "are playing"], answer: "will be playing" },
      { question: "He ____ at the gym when you call him.", options: ["will be exercising", "exercise", "will exercise", "is exercising"], answer: "will be exercising" },
      { question: "I ____ my homework while you are cooking.", options: ["will be doing", "do", "will do", "am doing"], answer: "will be doing" },
      { question: "She ____ her car to work at this time tomorrow.", options: ["will be driving", "drives", "will drive", "is driving"], answer: "will be driving" },
      { question: "We ____ lunch together at 1 p.m. tomorrow.", options: ["will be having", "have", "will have", "are having"], answer: "will be having" },
      { question: "They ____ the piano when the guests arrive.", options: ["will be playing", "play", "will play", "are playing"], answer: "will be playing" },
      { question: "At 10 o'clock, she ____ a presentation to the team.", options: ["will be giving", "gives", "will give", "is giving"], answer: "will be giving" },
      { question: "I ____ my new project all day tomorrow.", options: ["will be working on", "work on", "will work on", "am working on"], answer: "will be working on" }
], 
    "Present Perfect Continuous": [
      { question: "I ____ for my keys for two hours.", options: ["have been looking", "look", "am looking", "will be looking"], answer: "have been looking" },
      { question: "She ____ English since last year.", options: ["has been studying", "studies", "is studying", "will study"], answer: "has been studying" },
      { question: "We ____ here for over 30 minutes.", options: ["have been waiting", "wait", "are waiting", "will wait"], answer: "have been waiting" },
      { question: "They ____ all morning.", options: ["have been working", "work", "are working", "will work"], answer: "have been working" },
      { question: "He ____ to fix his bike since yesterday.", options: ["has been trying", "tries", "is trying", "will try"], answer: "has been trying" },
      { question: "I ____ this book for the past week.", options: ["have been reading", "read", "am reading", "will read"], answer: "have been reading" },
      { question: "She ____ a lot of noise lately.", options: ["has been making", "makes", "is making", "will make"], answer: "has been making" },
      { question: "We ____ at the same company for five years.", options: ["have been working", "work", "are working", "will work"], answer: "have been working" },
      { question: "They ____ in the garden all afternoon.", options: ["have been playing", "play", "are playing", "will play"], answer: "have been playing" },
      { question: "He ____ too much TV recently.", options: ["has been watching", "watches", "is watching", "will watch"], answer: "has been watching" },
      { question: "I ____ for this moment my whole life.", options: ["have been waiting", "wait", "am waiting", "will wait"], answer: "have been waiting" },
      { question: "She ____ up late these days.", options: ["has been staying", "stays", "is staying", "will stay"], answer: "has been staying" },
      { question: "We ____ more customers than usual lately.", options: ["have been getting", "get", "are getting", "will get"], answer: "have been getting" },
      { question: "They ____ about moving to a bigger house.", options: ["have been talking", "talk", "are talking", "will talk"], answer: "have been talking" },
      { question: "He ____ better at playing the guitar.", options: ["has been getting", "gets", "is getting", "will get"], answer: "has been getting" },
      { question: "I ____ to improve my cooking skills.", options: ["have been trying", "try", "am trying", "will try"], answer: "have been trying" },
      { question: "She ____ with her friend on the phone for hours.", options: ["has been talking", "talks", "is talking", "will talk"], answer: "has been talking" },
      { question: "We ____ plans for our summer vacation.", options: ["have been making", "make", "are making", "will make"], answer: "have been making" },
      { question: "They ____ the same movie over and over again.", options: ["have been watching", "watch", "are watching", "will watch"], answer: "have been watching" },
      { question: "He ____ to fix the computer since this morning.", options: ["has been trying", "tries", "is trying", "will try"], answer: "has been trying" }
],
    "Past Perfect Continuous": [
      { question: "I ____ for an hour before the bus finally arrived.", options: ["had been waiting", "waited", "was waiting", "have been waiting"], answer: "had been waiting" },
      { question: "She ____ all night before she finished the report.", options: ["had been working", "worked", "was working", "has been working"], answer: "had been working" },
      { question: "We ____ for thirty minutes when it started to rain.", options: ["had been running", "ran", "were running", "have been running"], answer: "had been running" },
      { question: "They ____ in the garden for hours before it got dark.", options: ["had been playing", "played", "were playing", "have been playing"], answer: "had been playing" },
      { question: "He ____ English for two years before he moved to London.", options: ["had been studying", "studied", "was studying", "has been studying"], answer: "had been studying" },
      { question: "I ____ for the phone to ring all morning.", options: ["had been waiting", "waited", "was waiting", "have been waiting"], answer: "had been waiting" },
      { question: "She ____ at the company for five years before she got promoted.", options: ["had been working", "worked", "was working", "has been working"], answer: "had been working" },
      { question: "We ____ for over an hour before they let us in.", options: ["had been standing", "stood", "were standing", "have been standing"], answer: "had been standing" },
      { question: "They ____ in the queue since early morning.", options: ["had been waiting", "waited", "were waiting", "have been waiting"], answer: "had been waiting" },
      { question: "He ____ for months before he finally found a job.", options: ["had been applying", "applied", "was applying", "has been applying"], answer: "had been applying" },
      { question: "I ____ to fix my computer for three hours before I gave up.", options: ["had been trying", "tried", "was trying", "have been trying"], answer: "had been trying" },
      { question: "She ____ too much coffee that day, so she couldn't sleep.", options: ["had been drinking", "drank", "was drinking", "has been drinking"], answer: "had been drinking" },
      { question: "We ____ for a taxi for twenty minutes before one stopped.", options: ["had been waiting", "waited", "were waiting", "have been waiting"], answer: "had been waiting" },
      { question: "They ____ football when it suddenly started raining.", options: ["had been playing", "played", "were playing", "have been playing"], answer: "had been playing" },
      { question: "He ____ to call her all week but never managed to.", options: ["had been meaning", "meant", "was meaning", "has been meaning"], answer: "had been meaning" },
      { question: "I ____ in traffic for over an hour before reaching the office.", options: ["had been sitting", "sat", "was sitting", "have been sitting"], answer: "had been sitting" },
      { question: "She ____ for a new apartment for several months before she found one.", options: ["had been looking", "looked", "was looking", "has been looking"], answer: "had been looking" },
      { question: "We ____ about the problem before you mentioned it.", options: ["had been talking", "talked", "were talking", "have been talking"], answer: "had been talking" },
      { question: "They ____ for the train for half an hour before it arrived.", options: ["had been waiting", "waited", "were waiting", "have been waiting"], answer: "had been waiting" },
      { question: "He ____ for years before he became successful.", options: ["had been working", "worked", "was working", "has been working"], answer: "had been working" }
],
    "Future Perfect Continuous": [
      { question: "By next month, I ____ here for two years.", options: ["will have been working", "will work", "will be working", "work"], answer: "will have been working" },
      { question: "By the end of this year, she ____ in Paris for five years.", options: ["will have been living", "will live", "will be living", "lives"], answer: "will have been living" },
      { question: "By 5 p.m., we ____ for over eight hours.", options: ["will have been driving", "will drive", "will be driving", "drive"], answer: "will have been driving" },
      { question: "By the time you arrive, they ____ for two hours.", options: ["will have been waiting", "will wait", "will be waiting", "wait"], answer: "will have been waiting" },
      { question: "By July, I ____ this project for six months.", options: ["will have been working on", "will work on", "will be working on", "work on"], answer: "will have been working on" },
      { question: "By next Friday, she ____ for the company for ten years.", options: ["will have been working", "will work", "will be working", "works"], answer: "will have been working" },
      { question: "By the time we get there, it ____ snowing for hours.", options: ["will have been snowing", "will snow", "will be snowing", "snows"], answer: "will have been snowing" },
      { question: "By this time next week, I ____ for my exams for a month.", options: ["will have been studying", "will study", "will be studying", "study"], answer: "will have been studying" },
      { question: "By the end of the day, they ____ since morning.", options: ["will have been traveling", "will travel", "will be traveling", "travel"], answer: "will have been traveling" },
      { question: "By tomorrow evening, he ____ his essay for a week.", options: ["will have been writing", "will write", "will be writing", "writes"], answer: "will have been writing" },
      { question: "By the end of this course, I ____ English for three years.", options: ["will have been learning", "will learn", "will be learning", "learn"], answer: "will have been learning" },
      { question: "By 10 o'clock, she ____ for the guests for over an hour.", options: ["will have been preparing", "will prepare", "will be preparing", "prepares"], answer: "will have been preparing" },
      { question: "By the time you finish, we ____ here for ages.", options: ["will have been sitting", "will sit", "will be sitting", "sit"], answer: "will have been sitting" },
      { question: "By next winter, they ____ the house for over a year.", options: ["will have been building", "will build", "will be building", "build"], answer: "will have been building" },
      { question: "By the time we meet again, I ____ abroad for six months.", options: ["will have been living", "will live", "will be living", "live"], answer: "will have been living" },
      { question: "By the end of the month, she ____ piano lessons for two years.", options: ["will have been taking", "will take", "will be taking", "takes"], answer: "will have been taking" },
      { question: "By this time tomorrow, I ____ without a break for five hours.", options: ["will have been working", "will work", "will be working", "work"], answer: "will have been working" },
      { question: "By July, we ____ this research for almost a year.", options: ["will have been conducting", "will conduct", "will be conducting", "conduct"], answer: "will have been conducting" },
      { question: "By the time the sun sets, they ____ on the road since morning.", options: ["will have been driving", "will drive", "will be driving", "drive"], answer: "will have been driving" },
      { question: "By the end of next week, you ____ this training for two months.", options: ["will have been attending", "will attend", "will be attending", "attend"], answer: "will have been attending" }
]
};
  document.getElementById('exercise-area').style.display = 'block';
  document.getElementById('exercise-title').innerText = `B√†i t·∫≠p - ${tense}`;
  document.getElementById('exercise-questions').innerHTML = "ƒêang t·∫°o b√†i t·∫≠p...";

  // H√†m ƒë·∫£o ng·∫´u nhi√™n
  function shuffleArray(arr) {
    return arr
      .map(value => ({ value, sort: Math.random() }))
      .sort((a, b) => a.sort - b.sort)
      .map(({ value }) => value);
  }

  // T·∫°o v√≤ng tr√≤n ƒëi·ªÉm
  if (!document.getElementById('score-circle')) {
    const circle = document.createElement('div');
    circle.id = 'score-circle';
    circle.style = `
      position:fixed;top:32px;right:32px;
      width:70px;height:70px;
      background:transparent;
      border:4px solid #1976d2;
      color:#1976d2;
      border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      font-size:2rem;font-weight:bold;
      z-index:9999;user-select:none;
    `;
    circle.innerHTML = '<span id="score-circle-value">0</span>';
    document.body.appendChild(circle);
  }
  document.getElementById('score-circle').style.display = 'flex';
  document.getElementById('score-circle-value').textContent = '0';

  let questions = manualQuestions[tense] || [];
  if (questions.length === 0) {
    document.getElementById('exercise-questions').innerHTML = "<p>Ch∆∞a c√≥ c√¢u h·ªèi cho th√¨ n√†y.</p>";
    return;
  }

  // ƒê·∫£o ng·∫´u nhi√™n c√¢u h·ªèi v√† ƒë·∫£m b·∫£o kh√¥ng tr√πng
  questions = shuffleArray(questions);
  questions = questions.slice(0, 20); // Gi·ªõi h·∫°n s·ªë c√¢u h·ªèi t·ªëi ƒëa l√† 20

  let currentScore = 0;

  // CSS ƒë·∫πp
  const style = document.createElement("style");
  style.textContent = `
    .question-block {
      background: #ffffff;
      border-radius: 10px;
      padding: 15px 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .question-block h4 {
      color: #1976d2;
      margin-bottom: 15px;
    }
    .option-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .ex-option {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: #f0f0f0;
      cursor: pointer;
      flex: 1;
      min-width: 80px;
      transition: background 0.3s, transform 0.2s;
      font-size: 1rem;
    }
    .ex-option:hover:not(:disabled) {
      background: #e3f2fd;
      transform: scale(1.03);
    }
    .ex-option.correct {
      background: #4CAF50 !important;
      color: #fff !important;
    }
    .ex-option.wrong {
      background: #f44336 !important;
      color: #fff !important;
    }
  `;
  document.head.appendChild(style);

  // Render c√¢u h·ªèi
  let html = '';
  questions.forEach((q, idx) => {
    html += `
      <div class="question-block" data-qidx="${idx}">
        <h4>C√¢u ${idx + 1}. ${q.question} (0.5 ƒëi·ªÉm)</h4>
        <div class="option-row">
          ${q.options.map(opt => `
            <button class="ex-option" data-qidx="${idx}" data-ans="${opt}">
              ${opt}
            </button>
          `).join('')}
        </div>
        <div class="ex-feedback" style="min-height:20px;margin-top:5px;"></div>
      </div>
    `;
  });

  html += `
    <div style="margin-top:2rem;font-size:1.2rem;font-weight:bold;">
      T·ªïng ƒëi·ªÉm: <span id="final-score">0</span> / ${(questions.length * 0.5).toFixed(1)}
    </div>
  `;
  document.getElementById('exercise-questions').innerHTML = html;

  let answered = Array(questions.length).fill(false);

  // X·ª≠ l√Ω ch·ªçn ƒë√°p √°n
  document.querySelectorAll('.ex-option').forEach(btn => {
    btn.addEventListener('click', function () {
      const qidx = parseInt(this.dataset.qidx);
      if (answered[qidx]) return;

      const userAns = this.dataset.ans;
      const correctAns = questions[qidx].answer;
      const parentBlock = this.closest('.question-block');
      const feedback = parentBlock.querySelector('.ex-feedback');

      if (userAns === correctAns) {
        this.classList.add("correct");
        feedback.innerHTML = `<span style="color:green;">ƒê√∫ng! +0.5 ƒëi·ªÉm</span>`;
        currentScore += 0.5;
        showScoreEffect(this, "+0.5");
      } else {
        this.classList.add("wrong");
        feedback.innerHTML = `<span style="color:red;">Sai!</span>`;
      }

      answered[qidx] = true;
      parentBlock.querySelectorAll('.ex-option').forEach(b => b.disabled = true);

      document.getElementById('score-circle-value').textContent = currentScore.toFixed(1);
      document.getElementById('final-score').textContent = currentScore.toFixed(1);
    });
  });

  // Hi·ªáu ·ª©ng +0.5
  function showScoreEffect(button, text) {
    const effect = document.createElement('span');
    effect.textContent = text;
    effect.style.position = 'absolute';
    effect.style.color = 'green';
    effect.style.fontWeight = 'bold';
    effect.style.left = (button.getBoundingClientRect().left + window.scrollX + button.offsetWidth / 2 - 10) + "px";
    effect.style.top = (button.getBoundingClientRect().top + window.scrollY - 10) + "px";
    effect.style.opacity = '1';
    effect.style.transition = 'all 0.8s ease-out';
    document.body.appendChild(effect);

    requestAnimationFrame(() => {
      effect.style.transform = 'translateY(-20px)';
      effect.style.opacity = '0';
    });

    setTimeout(() => effect.remove(), 800);
  }
}



/* Ph·∫ßn C√¢u */ 
/* N√∫t Tho√°t B√†i T·∫≠p */
function closeExercise() {
  document.getElementById('exercise-area').style.display = 'none';
  if (document.getElementById('score-circle')) {
    document.getElementById('score-circle').style.display = 'none';
  }
}
const expressions = {
  "Bi·ªÉu hi·ªán": [
    { en: "How are you?", ipa: "/ha ä …ëÀê juÀê/", vn: "B·∫°n kh·ªèe kh√¥ng?" },
    { en: "Nice to meet you.", ipa: "/na…™s t…ô miÀêt juÀê/", vn: "R·∫•t vui ƒë∆∞·ª£c g·∫∑p b·∫°n." },
    { en: "Thank you very much.", ipa: "/Œ∏√¶≈ãk juÀê Ààv…õri m åt É/", vn: "C·∫£m ∆°n b·∫°n r·∫•t nhi·ªÅu." },
    { en: "I love you.", ipa: "/a…™ l åv juÀê/", vn: "T√¥i y√™u b·∫°n." },
    { en: "Goodbye!", ipa: "/…° ädÀàba…™/", vn: "T·∫°m bi·ªát!" }
  ],
  "C∆° th·ªÉ v√† s·ª©c kh·ªèe": [
    { en: "Take care of your health.", ipa: "/te…™k ke…ô …ôv j…îÀê h…õlŒ∏/", vn: "ChƒÉm s√≥c s·ª©c kh·ªèe c·ªßa b·∫°n." },
    { en: "I have a headache.", ipa: "/a…™ h√¶v …ô Ààh…õdÀåe…™k/", vn: "T√¥i b·ªã ƒëau ƒë·∫ßu." },
    { en: "You should see a doctor.", ipa: "/juÀê  É äd siÀê …ô Ààd…íkt…ôr/", vn: "B·∫°n n√™n ƒëi kh√°m b√°c sƒ©." },
    { en: "Drink plenty of water.", ipa: "/dr…™≈ãk Ààpl…õnti …ôv Ààw…îÀêt…ô/", vn: "U·ªëng nhi·ªÅu n∆∞·ªõc." },
    { en: "Get well soon!", ipa: "/…°…õt w…õl suÀên/", vn: "Ch√∫c b·∫°n mau kh·ªèe!" }
  ],
  "Gia ƒë√¨nh": [
    { en: "Family is everything.", ipa: "/Ààf√¶m…™li …™z Àà…õvr…™Œ∏…™≈ã/", vn: "Gia ƒë√¨nh l√† t·∫•t c·∫£." },
    { en: "I love my parents.", ipa: "/a…™ l åv ma…™ Ààp…õ…ôr…ônts/", vn: "T√¥i y√™u cha m·∫π c·ªßa t√¥i." },
    { en: "Do you have any siblings?", ipa: "/duÀê juÀê h√¶v Àà…õni Ààs…™bl…™≈ãz/", vn: "B·∫°n c√≥ anh ch·ªã em kh√¥ng?" },
    { en: "My brother is younger than me.", ipa: "/ma…™ Ààbr å√∞…ôr …™z Ààj å≈ã…ôr √∞√¶n miÀê/", vn: "Em trai t√¥i nh·ªè h∆°n t√¥i." },
    { en: "We are a close-knit family.", ipa: "/wiÀê …ëÀêr …ô kl…ô äs-n…™t Ààf√¶m…™li/", vn: "Ch√∫ng t√¥i l√† m·ªôt gia ƒë√¨nh g·∫Øn b√≥." }
  ], 
  "Th·ªùi ti·∫øt": [
    { en: "It's sunny today.", ipa: "/…™ts Ààs åni t…ôÀàde…™/", vn: "H√¥m nay tr·ªùi n·∫Øng." },
    { en: "I love the rain.", ipa: "/a…™ l åv √∞…ô re…™n/", vn: "T√¥i th√≠ch m∆∞a." },
    { en: "It's very cold outside.", ipa: "/…™ts Ààv…õri k…ô äld Ààa ätsa…™d/", vn: "Ngo√†i tr·ªùi r·∫•t l·∫°nh." },
    { en: "The weather is perfect for a picnic.", ipa: "/√∞…ô Ààw…õ√∞…ôr …™z Ààp…úÀêrf…™kt f…îÀêr …ô Ààp…™kn…™k/", vn: "Th·ªùi ti·∫øt r·∫•t l√Ω t∆∞·ªüng cho m·ªôt bu·ªïi d√£ ngo·∫°i." },
    { en: "I hate the humidity.", ipa: "/a…™ he…™t √∞…ô hjuÀêÀàm…™d…ôti/", vn: "T√¥i gh√©t ƒë·ªô ·∫©m." }
  ],
  "Th·ª©c ƒÉn v√† ƒë·ªì u·ªëng": [
    { en: "I love Italian food.", ipa: "/a…™ l åv …™Ààt√¶lj…ôn fuÀêd/", vn: "T√¥i th√≠ch ƒë·ªì ƒÉn √ù." },
    { en: "Can I have a glass of water?", ipa: "/k√¶n a…™ h√¶v …ô …°l…ëÀês …ôv Ààw…îÀêt…ô/", vn: "T√¥i c√≥ th·ªÉ l·∫•y m·ªôt c·ªëc n∆∞·ªõc kh√¥ng?" },
    { en: "This dish is delicious!", ipa: "/√∞…™s d…™ É …™z d…™Ààl…™ É…ôs/", vn: "M√≥n n√†y r·∫•t ngon!" },
    { en: "I prefer coffee over tea.", ipa: "/a…™ pr…™Ààf…úÀêr Ààk…îÀêfi Àào äv…ôr tiÀê/", vn: "T√¥i th√≠ch c√† ph√™ h∆°n tr√†." },
    { en: "Do you like spicy food?", ipa: "/duÀê juÀê la…™k Ààspa…™si fuÀêd/", vn: "B·∫°n c√≥ th√≠ch ƒë·ªì ƒÉn cay kh√¥ng?" }
  ], 
  "Nh√†": [
    { en: "My house is my castle.", ipa: "/ma…™ ha äs …™z ma…™ Ààk√¶s…ôl/", vn: "Nh√† t√¥i l√† l√¢u ƒë√†i c·ªßa t√¥i." },
    { en: "I love decorating my room.", ipa: "/a…™ l åv Ààd…õk…ôre…™t…™≈ã ma…™ ruÀêm/", vn: "T√¥i th√≠ch trang tr√≠ ph√≤ng c·ªßa m√¨nh." },
    { en: "The kitchen is the heart of the home.", ipa: "/√∞…ô Ààk…™t É…ôn …™z √∞…ô h…ëÀêrt …ôv √∞…ô ho äm/", vn: "Nh√† b·∫øp l√† tr√°i tim c·ªßa ng√¥i nh√†." },
    { en: "We have a beautiful garden.", ipa: "/wiÀê h√¶v …ô ÀàbjuÀêt…ôf…ôl Àà…°…ëÀêrd…ôn/", vn: "Ch√∫ng t√¥i c√≥ m·ªôt khu v∆∞·ªùn ƒë·∫πp." },
    { en: "Home is where the heart is.", ipa: "/ho äm …™z w…õr √∞…ô h…ëÀêrt …™z/", vn: "Nh√† l√† n∆°i tr√°i tim ·ªü ƒë√≥." }
  ], 
  "C√¥ng vi·ªác": [
    { en: "I love my job.", ipa: "/a…™ l åv ma…™ d í…íb/", vn: "T√¥i y√™u c√¥ng vi·ªác c·ªßa m√¨nh." },
    { en: "Do you work from home?", ipa: "/duÀê juÀê w…úÀêrk fr…ôm ho äm/", vn: "B·∫°n l√†m vi·ªác t·∫°i nh√† kh√¥ng?" },
    { en: "My boss is very supportive.", ipa: "/ma…™ b…îÀês …™z Ààv…õri s…ôÀàp…îÀêrt…™v/", vn: "S·∫øp c·ªßa t√¥i r·∫•t h·ªó tr·ª£." },
    { en: "I need to finish this report by Friday.", ipa: "/a…™ niÀêd t…ô Ààf…™n…™ É √∞…™s r…™Ààp…îÀêrt ba…™ Ààfra…™de…™/", vn: "T√¥i c·∫ßn ho√†n th√†nh b√°o c√°o n√†y tr∆∞·ªõc th·ª© S√°u." },
    { en: "Teamwork makes the dream work.", ipa: "/ÀàtiÀêmw…úÀêrk me…™ks √∞…ô driÀêm w…úÀêrk/", vn: "L√†m vi·ªác nh√≥m bi·∫øn gi·∫•c m∆° th√†nh hi·ªán th·ª±c." }
  ], 
  "ƒê·ªãa ƒëi·ªÉm": [
    { en: "Where is the nearest hospital?", ipa: "/w…õr …™z √∞…ô Ààn…™…ôr…™st Ààh…ísp…™tl/", vn: "B·ªánh vi·ªán g·∫ßn nh·∫•t ·ªü ƒë√¢u?" },
    { en: "I love visiting new places.", ipa: "/a…™ l åv Ààv…™z…™t…™≈ã nuÀê Ààple…™s…™z/", vn: "T√¥i th√≠ch thƒÉm nh·ªØng n∆°i m·ªõi." },
    { en: "The museum is worth a visit.", ipa: "/√∞…ô mjuÀêÀàziÀê…ôm …™z w…úÀêrŒ∏ …ô Ààv…™z…™t/", vn: "B·∫£o t√†ng ƒë√°ng ƒë·ªÉ thƒÉm." },
    { en: "Can you show me the way?", ipa: "/k√¶n juÀê  Éo ä miÀê √∞…ô we…™/", vn: "B·∫°n c√≥ th·ªÉ ch·ªâ ƒë∆∞·ªùng cho t√¥i kh√¥ng?" },
    { en: "This city is full of life.", ipa: "/√∞…™s Ààs…™ti …™z f äl …ôv la…™f/", vn: "Th√†nh ph·ªë n√†y ƒë·∫ßy s·ª©c s·ªëng." }
  ],
  "C√¢u h·ªèi": [
    { en: "What time is it?", ipa: "/w…ít ta…™m …™z …™t/", vn: "B√¢y gi·ªù l√† m·∫•y gi·ªù?" },
    { en: "How much does this cost?", ipa: "/ha ä m åt É d åz √∞…™s k…íst/", vn: "C√°i n√†y gi√° bao nhi√™u?" },
    { en: "Where are you going?", ipa: "/w…õr …ëÀêr juÀê Àà…°o ä…™≈ã/", vn: "B·∫°n ƒëang ƒëi ƒë√¢u?" },
    { en: "Why did you do that?", ipa: "/wa…™ d…™d juÀê duÀê √∞√¶t/", vn: "T·∫°i sao b·∫°n l√†m v·∫≠y?" },
    { en: "Can you help me?", ipa: "/k√¶n juÀê h…õlp miÀê/", vn: "B·∫°n c√≥ th·ªÉ gi√∫p t√¥i kh√¥ng?" }
  ],
  "Mua s·∫Øm": [
    { en: "I want to buy this.", ipa: "/a…™ w…ínt t…ô ba…™ √∞…™s/", vn: "T√¥i mu·ªën mua c√°i n√†y." },
    { en: "Do you have a discount?", ipa: "/duÀê juÀê h√¶v …ô Ààd…™ska änt/", vn: "B·∫°n c√≥ gi·∫£m gi√° kh√¥ng?" },
    { en: "Can I try it on?", ipa: "/k√¶n a…™ tra…™ …™t …ín/", vn: "T√¥i c√≥ th·ªÉ th·ª≠ n√≥ kh√¥ng?" },
    { en: "This is too expensive.", ipa: "/√∞…™s …™z tuÀê …™kÀàsp…õns…™v/", vn: "C√°i n√†y qu√° ƒë·∫Øt." },
    { en: "Where is the nearest store?", ipa: "/w…õr …™z √∞…ô Ààn…™…ôr…™st st…îÀêr/", vn: "C·ª≠a h√†ng g·∫ßn nh·∫•t ·ªü ƒë√¢u?" }
  ], 
  "Th·ªÉ thao": [
    { en: "I love playing football.", ipa: "/a…™ l åv Ààple…™…™≈ã Ààf ätb…îÀêl/", vn: "T√¥i th√≠ch ch∆°i b√≥ng ƒë√°." },
    { en: "Do you like basketball?", ipa: "/duÀê juÀê la…™k Ààb…ëÀêsk…ôtb…îÀêl/", vn: "B·∫°n c√≥ th√≠ch b√≥ng r·ªï kh√¥ng?" },
    { en: "She is a great swimmer.", ipa: "/ ÉiÀê …™z …ô …°re…™t Ààsw…™m…ôr/", vn: "C√¥ ·∫•y l√† m·ªôt v·∫≠n ƒë·ªông vi√™n b∆°i l·ªôi gi·ªèi." },
    { en: "We play tennis every weekend.", ipa: "/wiÀê ple…™ Ààt…õn…™s Àà…õvri ÀàwiÀêk…õnd/", vn: "Ch√∫ng t√¥i ch∆°i qu·∫ßn v·ª£t m·ªói cu·ªëi tu·∫ßn." },
    { en: "He won the marathon.", ipa: "/hiÀê w ån √∞…ô Ààm√¶r…ôŒ∏…ôn/", vn: "Anh ·∫•y ƒë√£ th·∫Øng cu·ªôc thi marathon." }
  ],
  "Nghi√™n c·ª©u": [
    { en: "I love reading books.", ipa: "/a…™ l åv ÀàriÀêd…™≈ã b äks/", vn: "T√¥i th√≠ch ƒë·ªçc s√°ch." },
    { en: "Do you like science?", ipa: "/duÀê juÀê la…™k Ààsa…™…ôns/", vn: "B·∫°n c√≥ th√≠ch khoa h·ªçc kh√¥ng?" },
    { en: "She is studying history.", ipa: "/ ÉiÀê …™z Ààst ådi…™≈ã Ààh…™st…ôri/", vn: "C√¥ ·∫•y ƒëang h·ªçc l·ªãch s·ª≠." },
    { en: "We need to do more research.", ipa: "/wiÀê niÀêd t…ô duÀê m…îÀêr r…™Ààs…úÀêrt É/", vn: "Ch√∫ng ta c·∫ßn l√†m nhi·ªÅu nghi√™n c·ª©u h∆°n." },
    { en: "He is a famous scientist.", ipa: "/hiÀê …™z …ô Ààfe…™m…ôs Ààsa…™…ônt…™st/", vn: "√îng ·∫•y l√† m·ªôt nh√† khoa h·ªçc n·ªïi ti·∫øng." }
  ],
  "V·∫≠n chuy·ªÉn": [
    { en: "I need a taxi.", ipa: "/a…™ niÀêd …ô Ààt√¶ksi/", vn: "T√¥i c·∫ßn m·ªôt chi·∫øc taxi." },
    { en: "Where is the bus stop?", ipa: "/w…õr …™z √∞…ô b ås st…íp/", vn: "Tr·∫°m xe bu√Ωt ·ªü ƒë√¢u?" },
    { en: "Can you drive me to the airport?", ipa: "/k√¶n juÀê dra…™v miÀê t…ô √∞i Ààe…ôp…îÀêrt/", vn: "B·∫°n c√≥ th·ªÉ l√°i xe ƒë∆∞a t√¥i ƒë·∫øn s√¢n bay kh√¥ng?" },
    { en: "The train is late.", ipa: "/√∞…ô tre…™n …™z le…™t/", vn: "T√†u ƒë·∫øn mu·ªôn." },
    { en: "I love traveling by plane.", ipa: "/a…™ l åv Ààtr√¶v…ôl…™≈ã ba…™ ple…™n/", vn: "T√¥i th√≠ch ƒëi du l·ªãch b·∫±ng m√°y bay." }
  ],
  "Du l·ªãch": [
    { en: "I love traveling.", ipa: "/a…™ l åv Ààtr√¶v…ôl…™≈ã/", vn: "T√¥i th√≠ch du l·ªãch." },
    { en: "Where is the nearest hotel?", ipa: "/w…õr …™z √∞…ô Ààn…™…ôr…™st ho äÀàt…õl/", vn: "Kh√°ch s·∫°n g·∫ßn nh·∫•t ·ªü ƒë√¢u?" },
    { en: "Can you recommend a good restaurant?", ipa: "/k√¶n juÀê Àår…õk…ôÀàm…õnd …ô …° äd Ààr…õst…ôr…ínt/", vn: "B·∫°n c√≥ th·ªÉ gi·ªõi thi·ªáu m·ªôt nh√† h√†ng t·ªët kh√¥ng?" },
    { en: "I want to visit Paris.", ipa: "/a…™ w…ínt t…ô Ààv…™z…™t Ààp√¶r…™s/", vn: "T√¥i mu·ªën thƒÉm Paris." },
    { en: "The view is amazing!", ipa: "/√∞…ô vjuÀê …™z …ôÀàme…™z…™≈ã/", vn: "C·∫£nh ƒë·∫πp tuy·ªát v·ªùi!" }
  ]
};

function showExpressions(topic) {
  document.getElementById('expression-area').style.display = 'block';
  document.querySelector('#expression-area h2').textContent = topic;
  let html = '';
  (expressions[topic] || []).forEach(ex => {
    html += `
      <div class="expression-box">
        <div class="expression-ipa"><b>Phi√™n √¢m:</b> ${ex.ipa}</div>
        <div class="expression-en">
          <b>C√¢u:</b> ${ex.en}
          <button onclick="speakSentence('${ex.en.replace(/'/g,"\\'")}')" title="Nghe c√¢u n√†y" style="margin-left:8px; font-size:1.2rem; background:none; border:none; cursor:pointer;">üîä</button>
        </div>
        <div class="expression-vn"><b>Ti·∫øng Vi·ªát:</b> ${ex.vn}</div>
      </div>
    `;
  });
  document.getElementById('expression-list').innerHTML = html || "<i>Ch∆∞a c√≥ c√¢u cho ch·ªß ƒë·ªÅ n√†y.</i>";
}
function closeExpression() {
  document.getElementById('expression-area').style.display = 'none';
}
function speakSentence(sentence) {
  const synth = window.speechSynthesis;
  const utter = new SpeechSynthesisUtterance(sentence);
  utter.lang = 'en-US';
  synth.cancel();
  synth.speak(utter);
}

//Tr√≤ ch∆°i nhi·ªÅu l·ª±a ch·ªçn
let currentWord, currentOptions, attempts;

document.querySelectorAll(".game-box").forEach(box=>{
  if(box.querySelector(".game-label").innerText==="Nhi·ªÅu l·ª±a ch·ªçn"){
    box.onclick = ()=> openMultipleChoice();
  }
});

function openMultipleChoice(){
  document.getElementById("multiple-choice-area").style.display="block";
  nextQuestion();
}
function closeMultipleChoice(){
  document.getElementById("multiple-choice-area").style.display="none";
}

function generateQuestion(){
  let word = vocabulary[Math.floor(Math.random()*vocabulary.length)];
  let correct = word.vn;

  // ch·ªçn 3 ƒë√°p √°n sai
  let wrongs = vocabulary.filter(w=>w.vn!==correct);
  wrongs = wrongs.sort(()=>0.5-Math.random()).slice(0,3).map(w=>w.vn);

  let options = [...wrongs, correct].sort(()=>0.5-Math.random());

  return {word, options, correct};
}

function renderQuestion(){
  document.getElementById("mc-question").innerText = currentWord.eng;
  let container = document.getElementById("mc-options");
  container.innerHTML="";
  currentOptions.forEach(opt=>{
    let div=document.createElement("div");
    div.className="mc-option";
    div.innerText=opt;
    div.onclick=()=>chooseOption(div,opt);
    container.appendChild(div);
  });
  document.getElementById("mc-retry").style.display="none";
  document.getElementById("mc-next").style.display="none";
  // üîä T·ª± ƒë·ªông ph√°t √¢m t·ª´
  speakWord(currentWord.eng);
}

function chooseOption(el,opt){
  if(attempts <= 0) return;

  if(opt === currentWord.vn){
    // ch·ªçn ƒë√∫ng
    el.classList.add("disabled");
    el.style.background="#4caf50"; el.style.color="#fff";
    el.innerHTML = opt + '<span class="circle-mark green">‚úî</span>';
    playSound("correct");
    document.getElementById("mc-retry").style.display="inline-block";
    document.getElementById("mc-next").style.display="inline-block";
    attempts = 0;
    addWordToFlashcards(currentWord);
  } else {
    // ch·ªçn sai
    el.classList.add("disabled");
    el.style.background="#e53935"; el.style.color="#fff";
    el.innerHTML = opt + '<span class="circle-mark red">‚úñ</span>';
    playSound("wrong");
    attempts--;

    if(attempts === 0){
      // h·∫øt l∆∞·ª£t ‚Üí show ƒë√°p √°n ƒë√∫ng v√† ch·ªâ cho "Ti·∫øp theo"
      let opts = document.querySelectorAll(".mc-option");
      opts.forEach(d=>{
        if(d.innerText===currentWord.vn){
          d.style.background="#4caf50"; d.style.color="#fff";
          d.innerHTML = currentWord.vn + '<span class="circle-mark green">‚úî</span>';
        }
      });
      document.getElementById("mc-retry").style.display="none";
      document.getElementById("mc-next").style.display="inline-block";
    }
  }
}

  function retryQuestion(){ renderQuestion(); attempts=3; }
  function nextQuestion(){
    let q=generateQuestion();
    currentWord=q.word;
    currentOptions=q.options;
    attempts=3;
    renderQuestion();
  }
  function speakWord(word){
    let utterance = new SpeechSynthesisUtterance(word);
    utterance.lang = "en-US"; // n·∫øu mu·ªën gi·ªçng UK th√¨ ƒë·ªïi th√†nh "en-GB"
    speechSynthesis.cancel(); // h·ªßy ƒë·ªçc t·ª´ tr∆∞·ªõc (n·∫øu c√≤n)
    speechSynthesis.speak(utterance);
  }

  // √ÇM THANH ƒê√öNG/SAI 
  function playSound(type){
    if(type === "correct"){
      document.getElementById("sound-correct").play();
    } else if(type === "wrong"){
      document.getElementById("sound-wrong").play();
    }
  }
  function playSound(type){
  let audio = (type==="correct") ? document.getElementById("sound-correct") : document.getElementById("sound-wrong");
  if(audio){
    audio.pause();        // ‚è∏ d·ª´ng √¢m thanh n·∫øu ƒëang ph√°t
    audio.currentTime = 0; // ‚è™ tua v·ªÅ ƒë·∫ßu
    audio.play();          // ‚ñ∂ ph√°t l·∫°i
  }
}

  // ƒêO√ÅN T·ª™
  let gwCurrentWord, gwCurrentOptions, gwAttempts;

  document.querySelectorAll(".game-box").forEach(box=>{
    if(box.querySelector(".game-label").innerText==="ƒêo√°n T·ª´"){
      box.onclick = ()=> openGuessWord();
    }
  });

  function openGuessWord(){
    document.getElementById("guess-word-area").style.display="block";
    nextGuessWord();
  }
  function closeGuessWord(){
    document.getElementById("guess-word-area").style.display="none";
  }

  function generateGuessWord(){
    let word = vocabulary[Math.floor(Math.random()*vocabulary.length)];
    let correct = word.eng;

    // ch·ªçn 3 ƒë√°p √°n sai
    let wrongs = vocabulary.filter(w=>w.eng!==correct);
    wrongs = wrongs.sort(()=>0.5-Math.random()).slice(0,3).map(w=>w.eng);

    let options = [...wrongs, correct].sort(()=>0.5-Math.random());

    return {word, options, correct};
  }

  function renderGuessWord(){
    document.getElementById("gw-question").innerText = gwCurrentWord.vn;
    let container = document.getElementById("gw-options");
    container.innerHTML="";
    gwCurrentOptions.forEach(opt=>{
      let div=document.createElement("div");
      div.className="mc-option";
      div.innerText=opt;
      div.onclick=()=>chooseGuessOption(div,opt);
      container.appendChild(div);
    });
    document.getElementById("gw-retry").style.display="none";
    document.getElementById("gw-next").style.display="none";
  }

  function chooseGuessOption(el,opt){
    if(gwAttempts<=0) return;

    if(opt===gwCurrentWord.eng){
      el.classList.add("disabled");
      el.style.background="#4caf50"; el.style.color="#fff";
      el.innerHTML = opt + '<span class="circle-mark green">‚úî</span>';
      // üîä Ph√°t √¢m hi·ªáu ·ª©ng ƒë√∫ng
      playSound("correct");
      // üîä ph√°t √¢m khi ch·ªçn ƒë√∫ng
      speakWord(opt);
      document.getElementById("gw-retry").style.display="inline-block";
      document.getElementById("gw-next").style.display="inline-block";
      gwAttempts=0;
      addWordToFlashcards(gwCurrentWord);
    } else {
      el.classList.add("disabled");
      el.style.background="#e53935"; el.style.color="#fff";
      el.innerHTML = opt + '<span class="circle-mark red">‚úñ</span>';
      // üîä Ph√°t √¢m hi·ªáu ·ª©ng 
      playSound("wrong");
      // üîä ph√°t √¢m t·ª´ v·ª´a ch·ªçn (d√π sai c≈©ng ƒë·ªçc ƒë·ªÉ luy·ªán nghe)
      speakWord(opt);
      gwAttempts--;
      if(gwAttempts===0){
        // show ƒë√°p √°n ƒë√∫ng
        let opts = document.querySelectorAll("#gw-options .mc-option");
        opts.forEach(d=>{
          if(d.innerText===gwCurrentWord.eng){
            d.style.background="#4caf50"; d.style.color="#fff";
            d.innerHTML = gwCurrentWord.eng + '<span class="circle-mark green">‚úî</span>';
          }
        });
        document.getElementById("gw-retry").style.display="none";
        document.getElementById("gw-next").style.display="inline-block";
      }
    }
  }
  function retryGuessWord(){ renderGuessWord(); gwAttempts=3; }
  function nextGuessWord(){
    let q=generateGuessWord();
    gwCurrentWord=q.word;
    gwCurrentOptions=q.options;
    gwAttempts=3;
    renderGuessWord();
  }

//B·∫£ng ƒêi·ªÅu Khi·ªÉn
  let cbCurrentWord = null;
  let cbPairs = {};
  let cbSelected = []; // l∆∞u 6 t·ª´ c·ªßa b√†i hi·ªán t·∫°i
  let cbStartIndex = 0; // v·ªã tr√≠ t·ª´ trong vocabulary

  document.querySelectorAll(".game-box").forEach(box=>{
  if(box.querySelector(".game-label").innerText==="B·∫£ng ƒëi·ªÅu khi·ªÉn"){
    box.onclick = ()=> openControlBoard();
  }
});

function openControlBoard() {
  document.getElementById("control-board-area").style.display = "block";
  setupControlBoard();
}

function closeControlBoard() {
  document.getElementById("control-board-area").style.display = "none";
  document.getElementById("cb-pronunciation").innerText = "";
}

  function setupControlBoard() {
  const grid = document.getElementById("cb-grid");
  grid.innerHTML = "";
  document.getElementById("cb-pronunciation").innerText = "";
  document.getElementById("cb-actions").style.display = "none"; // ·∫©n n√∫t l·∫∑p l·∫°i & ti·∫øp theo

  // üëâ L·∫•y 6 t·ª´ t·ª´ m·∫£ng vocabulary b·∫Øt ƒë·∫ßu t·ª´ cbStartIndex
  cbSelected = vocabulary.slice(cbStartIndex, cbStartIndex + 6);

  // N·∫øu kh√¥ng ƒë·ªß 6 t·ª´, quay v√≤ng l·∫°i t·ª´ ƒë·∫ßu
  if (cbSelected.length < 6) {
    cbStartIndex = 0;
    cbSelected = vocabulary.slice(cbStartIndex, cbStartIndex + 6);
  }

  // T·∫°o danh s√°ch g·ªìm c·∫£ eng v√† pronunciation
  let mixedList = [];
  cbPairs = {};

  cbSelected.forEach(item => {
    mixedList.push({ type: "eng", text: item.eng, pair: item.pronunciation });
    mixedList.push({ type: "ipa", text: item.pronunciation, pair: item.eng });
    cbPairs[item.eng] = item.pronunciation;
    cbPairs[item.pronunciation] = item.eng;
  });

  // Tr·ªôn l·∫´n 12 √¥
  mixedList.sort(() => 0.5 - Math.random());

  mixedList.forEach(word => {
    const div = document.createElement("div");
    div.className = "cb-card";
    div.innerText = word.text;
    div.onclick = () => handleCBClick(div, word.text);
    grid.appendChild(div);
  });
}
function handleCBClick(card, text) {
  if (card.classList.contains("correct") || card.classList.contains("gray")) return;

  if (!cbCurrentWord) {
    cbCurrentWord = { card, text };
    card.classList.add("gray");
  } else {
    if (cbPairs[cbCurrentWord.text] === text) {
      cbCurrentWord.card.classList.remove("gray");
      cbCurrentWord.card.classList.add("correct");
      card.classList.add("correct");

      document.getElementById("cb-pronunciation").innerText = cbPairs[text];
      cbCurrentWord = null;

      playSound("correct");

      addWordToFlashcards({ eng: text, vn: "", pronunciation: cbPairs[text] });

      // üëâ Ki·ªÉm tra n·∫øu ho√†n th√†nh h·∫øt
      if (document.querySelectorAll(".cb-card.correct").length === 12) {
        document.getElementById("cb-actions").style.display = "block";
      }
    } else {
      card.classList.add("incorrect");

      playSound("wrong");

      setTimeout(() => {
        card.classList.remove("incorrect");
      }, 800);
      cbCurrentWord.card.classList.remove("gray"); // b·ªè m√†u √¥ sai
      cbCurrentWord = null;
    }
  }
}
function repeatControlBoard() {
  setupControlBoard(); // gi·ªØ nguy√™n cbStartIndex, load l·∫°i 6 t·ª´ c≈©
}

function nextControlBoard() {
  cbStartIndex += 6; // sang 6 t·ª´ ti·∫øp theo
  setupControlBoard();
}

// Flash Cards 
let learnedWords = [];

function addWordToFlashcards(wordObj) {
  if (!learnedWords.find(w => w.eng === wordObj.eng)) {
    learnedWords.push(wordObj);
    updateFlashcards();
  }
}

function updateFlashcards() {
  const container = document.getElementById("flashcard-container");
  if (!container) return;
  container.innerHTML = "";

  // Render c√°c th·∫ª ƒë√£ h·ªçc
  learnedWords.forEach(word => {
  const card = document.createElement("div");
  card.className = "flashcard";
  card.innerHTML = `
    <div class="flashcard-inner">
      <div class="flashcard-front">
        <h3>${word.eng}</h3>
      </div>
      <div class="flashcard-back">
        <p>${word.vn}</p>
        <small>${word.pronunciation}</small>
      </div>
    </div>
  `;
  card.addEventListener("click", () => {
    card.classList.toggle("flipped");
  });
  container.appendChild(card);
});
  

  // Render th·∫ª d·∫•u ? cho ph·∫ßn c√≤n l·∫°i (gi·∫£ s·ª≠ 6 √¥)
  for (let i = learnedWords.length; i < 32; i++) {
    const card = document.createElement("div");
    card.className = "flashcard placeholder";
    card.innerHTML = `<span>?</span>`;
    card.onclick = () => showLockedMessage();
    container.appendChild(card);
  }
}

function showLockedMessage() {
  const modal = document.createElement("div");
  modal.className = "modal";
  modal.innerHTML = `
    <div class="modal-content">
      <p>üëâ B·∫°n h√£y ƒë·∫øn ch∆°i tr√≤ ch∆°i t·ª´ v·ª±ng ƒë·ªÉ l·∫•y th√™m t·ª´ nh√©!</p>
      <button onclick="closeModal(this)">Ok</button>
    </div>
  `;
  document.body.appendChild(modal);
}

function closeModal(btn) {
  btn.closest(".modal").remove();
}

// G·ªçi h√†m updateFlashcards() ngay t·ª´ ƒë·∫ßu ƒë·ªÉ hi·ªÉn th·ªã √¥ ?
updateFlashcards();


function openAccount() {
  const loggedIn = localStorage.getItem("loggedIn");
  if (loggedIn === "true") {
    showSection("level"); // N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p ‚Üí m·ªü level
  } else {
    showSection("account"); // N·∫øu ch∆∞a ‚Üí m·ªü form ƒëƒÉng nh·∫≠p / ƒëƒÉng k√Ω
  }
}

function toggleForms(type) {
  document.getElementById("registerForm").style.display = (type === "register") ? "block" : "none";
  document.getElementById("loginForm").style.display = (type === "login") ? "block" : "none";
}

function register() {
  const fullname = document.getElementById("fullname").value;
  const nickname = document.getElementById("nickname").value;
  const pass = document.getElementById("password").value;
  const confirm = document.getElementById("confirmPassword").value;

  if (pass !== confirm) {
    alert("M·∫≠t kh·∫©u kh√¥ng kh·ªõp!");
    return;
  }

  localStorage.setItem("account", JSON.stringify({ fullname, nickname, pass }));
  alert("ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.");
  toggleForms("login");
}

function login() {
  const acc = JSON.parse(localStorage.getItem("account"));
  const nickname = document.getElementById("loginNickname").value;
  const pass = document.getElementById("loginPassword").value;

  if (acc && acc.nickname === nickname && acc.pass === pass) {
    alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");
    localStorage.setItem("loggedIn", "true");
    showSection("level");
  } else {
    alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!");
  }
}

// Th√™m n√∫t ƒëƒÉng xu·∫•t (n·∫øu c·∫ßn)
function logout() {
  localStorage.removeItem("loggedIn");
  alert("B·∫°n ƒë√£ ƒëƒÉng xu·∫•t!");
  showSection("account");
}

  function increaseLearnedWords() {
  let data = JSON.parse(localStorage.getItem("gardenProgress")) || { learnedWords: 0, controlBoardDone: 0, dailyGoal: 30 };
  data.learnedWords += 1;
  localStorage.setItem("gardenProgress", JSON.stringify(data));
  console.log("üìö ƒê√£ h·ªçc th√™m 1 t·ª´. T·ªïng s·ªë:", data.learnedWords);
}

  function completeControlBoard() {
  let data = JSON.parse(localStorage.getItem("gardenProgress")) || { learnedWords: 0, controlBoardDone: 0, dailyGoal: 30 };
  data.controlBoardDone += 1;
  localStorage.setItem("gardenProgress", JSON.stringify(data));
  alert("üéØ B·∫°n ƒë√£ ho√†n th√†nh m·ªôt nhi·ªám v·ª• b·∫£ng ƒëi·ªÅu khi·ªÉn!");
}


    renderDictionary();
  </script>
      <audio id="sound-correct" src="sounds/correct.mp3"></audio>
      <audio id="sound-wrong" src="sounds/wrong.mp3"></audio>
</body>
</html>